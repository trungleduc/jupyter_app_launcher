"use strict";(self.webpackChunkjupyter_app_launcher=self.webpackChunkjupyter_app_launcher||[]).push([[163],{163:(e,t,n)=>{n.r(t),n.d(t,{default:()=>$});var o=n(12),i=n(61),s=n(512),r=n(132),a=n(840),d=n(322);async function c(e={},t=""){const n=d.ServerConnection.makeSettings(),i=o.URLExt.join(n.baseUrl,"jupyterlab-app-launcher",t);let s;try{s=await d.ServerConnection.makeRequest(i,e,n)}catch(e){throw new d.ServerConnection.NetworkError(e)}let r=await s.text();if(r.length>0)try{r=JSON.parse(r)}catch(e){console.log("Not a JSON response body.",s)}if(!s.ok)throw new d.ServerConnection.ResponseError(s,r.message||r);return r}class l extends i.WidgetTracker{constructor(e,t){super(e),this._runningInstances=[],this._widgetDisposed=new a.Signal(this),this._instanceChanged=new a.Signal(this),this._appName=t}async add(e){e.disposed.connect((async()=>{this._widgetDisposed.emit(e),await this.updateRunningInstance()})),super.add(e),await this.updateRunningInstance()}get widgetDisposed(){return this._widgetDisposed}get instanceChanged(){return this._instanceChanged}set runningInstance(e){this._runningInstances=e}get runningInstance(){return this._runningInstances}async updateRunningInstance(){"JupyterLite"!==this._appName&&(this._runningInstances=await c({method:"POST",body:JSON.stringify({method:"request_running_app"})}),this._instanceChanged.emit())}}var u=n(526);class p{async create(e,t){const n=u.UUID.uuid4(),s=o.PageConfig.getOption("baseUrl"),r=c({method:"POST",body:JSON.stringify({method:"request_resources",id:e.id,instanceId:n,labBasePrefix:s})}),a=new i.IFrame({sandbox:["allow-same-origin","allow-scripts","allow-downloads","allow-modals","allow-popups"]}),d=o.PageConfig.getBaseUrl();a.title.label=e.title,a.title.closable=!0,a.disposed.connect((async()=>{await c({method:"POST",body:JSON.stringify({method:"terminate_resources",id:e.id,instanceId:n})})}));const l=new u.PromiseDelegate;return r.then((e=>{a.url=d+e,l.resolve()})),{panel:a,ready:l.promise}}}var h=n(906),g=n(613),m=n(377);class y{constructor(e){this.options=e}async create(e,t){if(!e.sourceCode)return;const n=t.cwd,o=this.options.app,i=await o.commands.execute("docmanager:new-untitled",{path:n,type:"notebook",ext:".ipynb"}),s=await o.commands.execute("docmanager:open",{path:i.path});await s.context.ready,s.context.model.fromString(e.sourceCode),s.context.model.initialize();let r=!1,a=0;for(;!r;)try{await s.context.rename(`${e.title}${0===a?"":"-"+a}.ipynb`),r=!0}catch(e){a+=1}await s.context.save(),await s.sessionContext.ready,s.content.activeCellIndex=1}}var w=n(861),f=n(891),v=n(177),_=n(527);class b extends _.Context{async save(){await this.ready}async saveAs(){await this.ready}async revert(){await this.ready}}var C,k=n(992);class x extends k.Panel{constructor(e,t,n){super(),this.removeClass("lm-Widget"),this.removeClass("p-Widget"),this.addClass("grid-stack-item");const o=new k.Panel;o.addClass("grid-stack-item-content"),t.addClass("grid-item-widget"),o.addWidget(t),this.addWidget(o),this._cellOutput=t,this._info=n,this.cellIdentity=e}get cellOutput(){return this._cellOutput}get info(){return this._info}}class I{constructor(e){this.options=e,this._isDisposed=!1,this._notebook=e.notebook}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,this._context.dispose(),this._notebookPanel.dispose())}get notebook(){return this._notebook}get rendermime(){return this.options.rendermime}get cells(){return this._context.model.cells}get context(){return this._context}get panel(){return this._notebookPanel}async initialize(){this._context=await async function(e){var t,n,o;const i=new g.NotebookModelFactory({disableDocumentWideUndoRedo:!1}),s=e.manager,r=u.UUID.uuid4()+".ipynb";await s.ready;const a=new b({manager:s,factory:i,path:r,kernelPreference:{shouldStart:!0,canStart:!0,shutdownOnDispose:!0,name:null===(t=s.kernelspecs.specs)||void 0===t?void 0:t.default}});return await a.model.initialize(),await a.sessionContext.initialize(),await(null===(o=null===(n=a.sessionContext.session)||void 0===n?void 0:n.kernel)||void 0===o?void 0:o.info),a}({manager:this.options.manager}),this._context.model.fromJSON(this.options.notebook),this._notebookPanel=function(e,t){const n=function(e){const t=v.editorServices.factoryService.newInlineEditor.bind(v.editorServices.factoryService);return new g.Notebook({rendermime:e,contentFactory:new g.Notebook.ContentFactory({editorFactory:t}),mimeTypeService:v.editorServices.mimeTypeService})}(t);return new g.NotebookPanel({content:n,context:e})}(this._context,this.options.rendermime),this.options.tracker.widgetAdded.emit(this._notebookPanel)}_getCellInfo(e){var t;for(let n=0;n<this.cells.length;n++){const o=this.cells.get(n);if(o.id===e){const e=o.sharedModel.getMetadata().extensions;return null===(t=null==e?void 0:e.jupyter_dashboards)||void 0===t?void 0:t.views.grid_default}}}createCell(e){let t;const n=this._getCellInfo(e.id);switch(e.type){case"code":{const o=new f.OutputAreaModel({trusted:!0}),i=new f.SimplifiedOutputArea({model:o,rendermime:this.options.rendermime});t=new x(e.id,i,n);break}case"markdown":{const o=new w.MarkdownCell({model:e,rendermime:this.options.rendermime,contentFactory:this.options.contentFactory,editorConfig:this.options.editorConfig.markdown,updateEditorOnShow:!1});o.inputHidden=!1,o.rendered=!0,C.removeElements(o.node,"jp-Collapser"),C.removeElements(o.node,"jp-InputPrompt"),t=new x(e.id,o,n);break}default:{const o=new w.RawCell({model:e,contentFactory:this.options.contentFactory,editorConfig:this.options.editorConfig.raw,updateEditorOnShow:!1});o.inputHidden=!1,C.removeElements(o.node,"jp-Collapser"),C.removeElements(o.node,"jp-InputPrompt"),t=new x(e.id,o,n);break}}return t}async executeCell(e,t){if("code"!==e.type)return;const n=e.value.text;return await f.SimplifiedOutputArea.execute(n,t,this._context.sessionContext)}}!function(e){e.removeElements=function(e,t){const n=e.getElementsByClassName(t);for(let e=0;e<n.length;e++)n[e].remove()}}(C||(C={}));var S=n(918),P=n(720),O=n(591);class D extends k.Panel{constructor(e){super(),this._ready=new u.PromiseDelegate,this._gridElements=[],this.node.id=e.id,this.title.label=e.label,this.title.closable=!0,this._model=e.model,this._gridHost=document.createElement("div"),this._gridHost.className="grid-stack",this._gridHost.classList.add("jp-App-Launcher-gridhost"),this.node.appendChild(this._gridHost),this._spinner=document.createElement("div"),this._spinner.classList.add("jp-al-Spinner");const t=document.createElement("div");t.className="jp-al-SpinnerContent",this._spinner.appendChild(t),this.node.appendChild(this._spinner),this.node.style.overflow="auto",this._grid=O.GridStack.init({float:!0,column:12,margin:2,cellHeight:40,styleInHead:!0,disableOneColumnMode:!0},this._gridHost),this.render().catch(console.error).then((()=>window.dispatchEvent(new Event("resize"))))}get ready(){return this._ready.promise}get model(){return this._model}get gridWidgets(){return this._gridElements}dispose(){this.isDisposed||(this._model.dispose(),super.dispose())}addGridItem(e){this._gridElements.push(e);const t=e.info,n=e.cellIdentity;if(t&&t.hidden)return;const o={id:n,autoPosition:!0,noMove:!0,noResize:!0,locked:!0,w:12,h:1};t&&null!==t.row&&null!==t.col&&(o.x=t.col,o.y=t.row,o.w=t.width,o.h=t.height,o.autoPosition=!1),P.MessageLoop.sendMessage(e,k.Widget.Msg.BeforeAttach),this._grid.addWidget(e.node,o),P.MessageLoop.sendMessage(e,k.Widget.Msg.AfterAttach),this.updateGridItem(n,t)}updateGridItem(e,t){const n=this._grid.getGridItems(),o=null==n?void 0:n.find((t=>{var n;return(null===(n=t.gridstackNode)||void 0===n?void 0:n.id)===e}));if(!o)return;let i;i=t?{x:t.col,y:t.row,w:t.width,h:t.height,noMove:!0,noResize:!0,locked:!0}:{autoPosition:!0},this._grid.update(o,i)}async render(){const e=(0,S.toArray)(this._model.cells.iter());for(const t of e){if(0===t.value.text.length)continue;const e=this._model.createCell(t),n=await this._model.executeCell(t,e.cellOutput);e.cellOutput.node.childNodes.length>0&&(this.addGridItem(e),n&&"error"===n.content.status&&this.updateGridItem(e.cellIdentity,{width:12,height:4}))}this.node.removeChild(this._spinner)}onCloseRequest(e){this._model.dispose(),super.onCloseRequest(e)}}class N{constructor(e){this.options=e}async create(e){if(!e.sourceCode)return void console.error("Notebook source is missing");const t=JSON.parse(e.sourceCode);if(e.cwd){const n={cell_type:"code",execution_count:null,id:u.UUID.uuid4(),metadata:{extensions:{jupyter_dashboards:{activeView:"grid_default",views:{grid_default:{col:null,height:2,hidden:!0,locked:!0,row:null,width:2}}}}},outputs:[],source:["import os\n","try:\n",`  os.chdir('${e.cwd}')\n`,"except:\n","  pass"]};t.cells=[n,...t.cells]}const n=new I({notebook:t,manager:this.options.manager,rendermime:this.options.rendermime,tracker:this.options.tracker,contentFactory:this.options.contentFactory,mimeTypeService:this.options.mimeTypeService,editorConfig:g.StaticNotebook.defaultEditorConfig,notebookConfig:g.StaticNotebook.defaultNotebookConfig});return await n.initialize(),{panel:new D({id:u.UUID.uuid4(),label:e.title,model:n})}}}class M{constructor(){this._isDisposed=!1,this._factoryMap=new Map}registerFactory(e,t){this._factoryMap.has(e)&&console.warn(`Factory for ${e} is already registered, replacing!`),this._factoryMap.set(e,t)}getFactory(e){return this._factoryMap.get(e)}get isDisposed(){return this._isDisposed}dispose(){this._isDisposed}}const F=new u.Token("jupyterlab-app-launcher:IAppTracker"),R=new u.Token("jupyterlab-app-launcher:IPanelFactoryManager");class U{async create(e,t){const n=u.UUID.uuid4(),s=c({method:"POST",body:JSON.stringify({method:"request_resources",id:e.id,instanceId:n})}),r=new i.IFrame({sandbox:["allow-same-origin","allow-scripts","allow-downloads","allow-modals","allow-popups"]}),a=o.PageConfig.getBaseUrl();r.title.label=e.title,r.title.closable=!0,r.disposed.connect((async()=>{await c({method:"POST",body:JSON.stringify({method:"terminate_resources",id:e.id,instanceId:n})})}));const d=new u.PromiseDelegate;return s.then((e=>{r.url=a+e,d.resolve()})),{panel:r,ready:d.promise}}}class E{async create(e,t){const n=u.UUID.uuid4(),o={};if(e.args){const t=e.args.sandbox,n=e.args.referrerPolicy;t&&(o.sandbox=t),n&&(o.referrerPolicy=n)}const s=new i.IFrame(o);return s.title.label=e.title,s.title.closable=!0,s.disposed.connect((async()=>{await c({method:"POST",body:JSON.stringify({method:"terminate_resources",id:e.id,instanceId:n})})})),s.url=e.source,{panel:s}}}class T extends _.Context{constructor(){super(...arguments),this._customReadyPromise=new u.PromiseDelegate}async save(){await this.ready}async saveAs(){await this.ready}async revert(){await this.ready}get isReady(){return!0}get ready(){return this._customReadyPromise.promise}resolveReady(){this._customReadyPromise.resolve(void 0)}}var j=n(586);class A{constructor(e){this.options=e}async create(e,t){if(!e.sourceCode)return void console.error("Missing source code!");await this.options.manager.ready;const n=this.options.rendermime.clone(),o=new _.TextModelFactory,i=u.UUID.uuid4()+".md",s=new T({manager:this.options.manager,factory:o,path:i});await s.model.initialize(),await s.sessionContext.initialize(),s.model.fromString(e.sourceCode),s.resolveReady(),await s.ready;const r=n.createRenderer("text/markdown"),a=new j.MarkdownViewer({context:s,renderer:r});return a.title.closable=!0,a.title.label=e.title,{panel:a}}}const J={id:"jupyter_app_launcher:panel-factory-manager",autoStart:!0,requires:[m.IRenderMimeRegistry,g.INotebookTracker,h.IEditorServices,g.NotebookPanel.IContentFactory],activate:(e,t,n,o,i)=>{const s=new M,r=new N({manager:e.serviceManager,rendermime:t,tracker:n,contentFactory:i,mimeTypeService:o.mimeTypeService});s.registerFactory("notebook-grid",r);const a=new y({app:e});s.registerFactory("notebook",a);const d=new p;s.registerFactory("notebook-voila",d);const c=new U;s.registerFactory("local-server",c);const l=new E;s.registerFactory("url",l);const u=new A({manager:e.serviceManager,rendermime:t});return s.registerFactory("markdown",u),s},provides:R};var L=n(655);function W(e){const t=u.UUID.uuid4(),n=e.split(" ");let o;o=1===n.length?n[0].substring(0,2):`${n[0].substring(0,1)}${n[1].substring(0,1)}`;const i=`<svg class="jp-al-app-icon" width="16" viewBox="0 0 24 24" role="img" xmlns="http://www.w3.org/2000/svg"><text x="0" y="16" fill="#000" style="font-size: 14px">${o.toUpperCase()}</text></svg>`;return new L.LabIcon({name:t,svgstr:i})}function z(e){const t=u.UUID.uuid4();return new L.LabIcon({name:t,svgstr:e})}class H{constructor(e){this.options=e}open(){}icon(){let e;return e=this.options.icon?z(this.options.icon):W(this.options.title),e}label(){return`${this.options.title} (${this.options.type})`}shutdown(){c({method:"POST",body:JSON.stringify({method:"terminate_resources",id:this.options.factoryId,instanceId:this.options.instanceId})}).then((()=>{this.options.tracker.updateRunningInstance()})).catch(console.error)}}const $=[J,{id:"jupyter_app_launcher:plugin",autoStart:!0,requires:[s.ILauncher,R],optional:[r.IRunningSessionManagers],activate:async function(e,t,n,s){console.log("JupyterLab extension jupyter_app_launcher is activated!");const{commands:r}=e,a=o.PageConfig.getOption("appName"),d=new l({namespace:"jupyterlab-app-launcher"},a);if((await async function(e){let t=[];if("JupyterLite"===e){const e=o.PageConfig.getOption("settingsOverrides");e.length>0&&(t=JSON.parse(e).appLauncherData.config)}else t=await c({method:"POST",body:JSON.stringify({method:"init_launcher"})});return t}(a)).forEach(((o,s)=>function(o,s){var a;let c;c=o.icon?z(o.icon):W(o.title),r.addCommand(o.id,{label:o.title,caption:o.description,icon:c,execute:async t=>{const s=n.getFactory(o.type);if(!s)return;const r=new k.BoxPanel({direction:"top-to-bottom",spacing:0}),a=new u.PromiseDelegate;if("notebook"!==o.type){r.title.label=o.title;const t=new i.MainAreaWidget({content:r,reveal:a.promise});e.shell.add(t,"main")}s.create(o,t).then((e=>{if(e){const{panel:t,ready:n}=e;r.addWidget(t),d.add(t),d.save(t),n?n.then((()=>a.resolve(void 0))):a.resolve(void 0)}})).catch(console.error)}}),t.add({command:o.id,category:null!==(a=o.catalog)&&void 0!==a?a:"Jupyter App",rank:s})}(o,s))),"JupyterLite"!==a&&(await d.updateRunningInstance(),s)){let e=[];s.add({name:"Launcher application",running:()=>(e=d.runningInstance.map((e=>new H({factoryId:e.factory_id,instanceId:e.instance_id,title:e.config.title,type:e.config.type,tracker:d}))),e),shutdownAll:()=>{e.forEach((e=>{e.shutdown()}))},refreshRunning:()=>{},runningChanged:d.instanceChanged,shutdownLabel:"Shut Down",shutdownAllLabel:"Shut Down All",shutdownAllConfirmationText:"Are you sure you want to permanently shut down all running applications?"})}return d},provides:F}]}}]);