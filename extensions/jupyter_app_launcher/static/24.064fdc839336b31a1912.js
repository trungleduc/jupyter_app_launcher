"use strict";(self.webpackChunkjupyter_app_launcher=self.webpackChunkjupyter_app_launcher||[]).push([[24],{9024:(e,t,n)=>{n.r(t),n.d(t,{default:()=>X});var o=n(5537),i=n(4030),s=n(5607),r=n(9145),a=n(4602),d=n(5778);async function c(e={},t=""){const n=d.ServerConnection.makeSettings(),i=o.URLExt.join(n.baseUrl,"jupyterlab-app-launcher",t);let s;try{s=await d.ServerConnection.makeRequest(i,e,n)}catch(e){throw new d.ServerConnection.NetworkError(e)}let r=await s.text();if(r.length>0)try{r=JSON.parse(r)}catch(e){console.log("Not a JSON response body.",s)}if(!s.ok)throw new d.ServerConnection.ResponseError(s,r.message||r);return r}class l extends i.WidgetTracker{constructor(e,t){super(e),this._runningInstances=[],this._widgetDisposed=new a.Signal(this),this._instanceChanged=new a.Signal(this),this._appName=t}async add(e){e.disposed.connect((async()=>{this._widgetDisposed.emit(e),await this.updateRunningInstance()})),super.add(e),await this.updateRunningInstance()}get widgetDisposed(){return this._widgetDisposed}get instanceChanged(){return this._instanceChanged}set runningInstance(e){this._runningInstances=e}get runningInstance(){return this._runningInstances}async updateRunningInstance(){"JupyterLite"!==this._appName&&(this._runningInstances=await c({method:"POST",body:JSON.stringify({method:"request_running_app"})}),this._instanceChanged.emit())}}var u=n(4651),p=n(528),h=n(5439),m=n(8353);class g{constructor(e){this._commands=e.commands}async create(e,t){const n=e.source;for(const e of n)try{await this._commands.execute(e.id,e.args)}catch(t){await(0,i.showErrorMessage)(`${e.label}: Error`,t);break}}}var y=n(7262);class w{async create(e,t){const n=y.UUID.uuid4(),s=c({method:"POST",body:JSON.stringify({method:"request_resources",id:e.id,instanceId:n})}),r=new i.IFrame({sandbox:["allow-same-origin","allow-scripts","allow-downloads","allow-modals","allow-popups"]}),a=o.PageConfig.getBaseUrl();r.title.label=e.title,r.title.closable=!0,r.disposed.connect((async()=>{await c({method:"POST",body:JSON.stringify({method:"terminate_resources",id:e.id,instanceId:n})})}));const d=new y.PromiseDelegate;return s.then((e=>{r.url=a+e,d.resolve()})),{panel:r,ready:d.promise}}}var v=n(3439);class f extends v.Context{constructor(){super(...arguments),this._customReadyPromise=new y.PromiseDelegate}async save(){await this.ready}async saveAs(){await this.ready}async revert(){await this.ready}get isReady(){return!0}get ready(){return this._customReadyPromise.promise}resolveReady(){this._customReadyPromise.resolve(void 0)}}var _=n(9662);class b{constructor(e){this.options=e}async create(e,t){if(!e.sourceCode)return void console.error("Missing source code!");await this.options.manager.ready;const n=this.options.rendermime.clone(),o=new v.TextModelFactory,i=y.UUID.uuid4()+".md",s=new f({manager:this.options.manager,factory:o,path:i});await s.sessionContext.initialize(),s.model.fromString(e.sourceCode),s.resolveReady(),await s.ready;const r=n.createRenderer("text/markdown"),a=new _.MarkdownViewer({context:s,renderer:r});return a.title.closable=!0,a.title.label=e.title,{panel:a}}}class k{constructor(e){this.options=e}async create(e,t){var n,o;if(!e.sourceCode)return;const{documentManager:i,fileBrowser:s}=this.options;let r=!1,a=0,d=e.title;const c=new Set([...s.model.items()].map((e=>e.name)));for(;!r;)d=`${e.title}${0===a?"":"-"+a}.ipynb`,c.has(d)?a+=1:r=!0;const l=new File([e.sourceCode],d);await s.model.upload(l);const u=null!==(o=(null!==(n=e.args)&&void 0!==n?n:{})["widget-type"])&&void 0!==o?o:"default",h=`${s.model.path}/${d}`,m=await i.openOrReveal(h,u);m?(await m.context.ready,m.context.model.fromString(e.sourceCode),await m.context.save(),m instanceof p.NotebookPanel&&(await m.sessionContext.ready,m.content.activeCellIndex=1)):console.error(`Failed to create widget with ${u} factory`)}}var C=n(4855),x=n(9074);class I extends v.Context{async save(){await this.ready}async saveAs(){await this.ready}async revert(){await this.ready}}var S,N=n(5256);class P extends N.Panel{constructor(e,t,n){super(),this.removeClass("lm-Widget"),this.removeClass("p-Widget"),this.addClass("grid-stack-item");const o=new N.Panel;o.addClass("grid-stack-item-content"),t.addClass("grid-item-widget"),o.addWidget(t),this.addWidget(o),this._cellOutput=t,this._info=n,this.cellIdentity=e}get cellOutput(){return this._cellOutput}get info(){return this._info}}class F{constructor(e){this.options=e,this._isDisposed=!1,this._notebook=e.notebook}get isDisposed(){return this._isDisposed}dispose(){var e,t;this.isDisposed||(this._isDisposed=!0,null===(e=this._context)||void 0===e||e.dispose(),null===(t=this._notebookPanel)||void 0===t||t.dispose())}get notebook(){return this._notebook}get rendermime(){return this.options.rendermime}get cells(){var e;return null===(e=this._context)||void 0===e?void 0:e.model.cells}get context(){return this._context}get panel(){return this._notebookPanel}async initialize(){this._context=await async function(e){var t,n,o;const i=new p.NotebookModelFactory({disableDocumentWideUndoRedo:!1}),s=e.manager,r=y.UUID.uuid4()+".ipynb";await s.ready;const a=new I({manager:s,factory:i,path:r,kernelPreference:{shouldStart:!0,canStart:!0,shutdownOnDispose:!0,name:null===(t=s.kernelspecs.specs)||void 0===t?void 0:t.default}});return await a.sessionContext.initialize(),await(null===(o=null===(n=a.sessionContext.session)||void 0===n?void 0:n.kernel)||void 0===o?void 0:o.info),a}({manager:this.options.manager}),this._context.model.fromJSON(this.options.notebook),this._notebookPanel=function(e){const{context:t,rendermime:n,editorServices:o}=e,i=function(e){const{rendermime:t,editorServices:n}=e,o=n.factoryService.newInlineEditor;return new p.Notebook({rendermime:t,contentFactory:new p.Notebook.ContentFactory({editorFactory:o}),mimeTypeService:n.mimeTypeService})}({rendermime:n,editorServices:o});return new p.NotebookPanel({content:i,context:t})}({context:this._context,rendermime:this.options.rendermime,editorServices:this.options.editorServices}),this.options.tracker.widgetAdded.emit(this._notebookPanel)}_getCellInfo(e){var t;if(this.cells)for(let n=0;n<this.cells.length;n++){const o=this.cells.get(n);if(o.id===e){const e=o.sharedModel.getMetadata().extensions;return null===(t=null==e?void 0:e.jupyter_dashboards)||void 0===t?void 0:t.views.grid_default}}}createCell(e){let t;const n=this._getCellInfo(e.id);switch(e.type){case"code":{const o=new x.OutputAreaModel({trusted:!0}),i=new x.SimplifiedOutputArea({model:o,rendermime:this.options.rendermime});t=new P(e.id,i,n);break}case"markdown":{const o=new C.MarkdownCell({model:e,rendermime:this.options.rendermime,contentFactory:this.options.contentFactory,editorConfig:this.options.editorConfig.markdown});o.inputHidden=!1,o.rendered=!0,S.removeElements(o.node,"jp-Collapser"),S.removeElements(o.node,"jp-InputPrompt"),t=new P(e.id,o,n);break}default:{const o=new C.RawCell({model:e,contentFactory:this.options.contentFactory,editorConfig:this.options.editorConfig.raw});o.inputHidden=!1,S.removeElements(o.node,"jp-Collapser"),S.removeElements(o.node,"jp-InputPrompt"),t=new P(e.id,o,n);break}}return t}async executeCell(e,t){if("code"!==e.type||!this._context)return;const n=e.sharedModel.source;return await x.SimplifiedOutputArea.execute(n,t,this._context.sessionContext)}}!function(e){e.removeElements=function(e,t){const n=e.getElementsByClassName(t);for(let e=0;e<n.length;e++)n[e].remove()}}(S||(S={}));var M=n(6230),D=n(8051);class O extends N.Panel{constructor(e){super(),this._ready=new y.PromiseDelegate,this._gridElements=[],this.node.id=e.id,this.title.label=e.label,this.title.closable=!0,this._model=e.model,this._gridHost=document.createElement("div"),this._gridHost.className="grid-stack",this._gridHost.classList.add("jp-App-Launcher-gridhost"),this.node.appendChild(this._gridHost),this._spinner=document.createElement("div"),this._spinner.classList.add("jp-al-Spinner");const t=document.createElement("div");t.className="jp-al-SpinnerContent",this._spinner.appendChild(t),this.node.appendChild(this._spinner),this.node.style.overflow="auto",this._grid=D.GridStack.init({float:!0,column:12,margin:3,cellHeight:40,styleInHead:!0,disableOneColumnMode:!0},this._gridHost),this._model.initialize().then((()=>{this.render().catch(console.error).then((()=>window.dispatchEvent(new Event("resize"))))}))}get ready(){return this._ready.promise}get model(){return this._model}get gridWidgets(){return this._gridElements}dispose(){this.isDisposed||(this._model.dispose(),super.dispose())}addGridItem(e){this._gridElements.push(e);const t=e.info,n=e.cellIdentity;if(t&&t.hidden)return;const o={id:n,autoPosition:!0,noMove:!0,noResize:!0,locked:!0,w:12,h:4};t&&null!==t.row&&null!==t.col&&(o.x=t.col,o.y=t.row,o.w=t.width,o.h=t.height,o.autoPosition=!1),M.MessageLoop.sendMessage(e,N.Widget.Msg.BeforeAttach),this._grid.addWidget(e.node,o),M.MessageLoop.sendMessage(e,N.Widget.Msg.AfterAttach)}updateGridItem(e,t){const n=this._grid.getGridItems(),o=null==n?void 0:n.find((t=>{var n;return(null===(n=t.gridstackNode)||void 0===n?void 0:n.id)===e}));if(!o)return;let i;i=t?{x:t.col,y:t.row,w:t.width,h:t.height,noMove:!0,noResize:!0,locked:!0}:{autoPosition:!0},this._grid.update(o,i)}async render(){var e;const t=null!==(e=this._model.cells)&&void 0!==e?e:[];for(const e of t){if(0===e.sharedModel.source.length)continue;const t=this._model.createCell(e),n=await this._model.executeCell(e,t.cellOutput);t.cellOutput.node.childNodes.length>0&&(this.addGridItem(t),n&&"error"===n.content.status&&this.updateGridItem(t.cellIdentity,{width:12,height:4}))}this.node.removeChild(this._spinner)}onCloseRequest(e){this._model.dispose(),super.onCloseRequest(e)}}class T{constructor(e){this.options=e}async create(e){if(!e.sourceCode)return void console.error("Notebook source is missing");const t=JSON.parse(e.sourceCode);if(e.cwd){const n={cell_type:"code",execution_count:null,id:y.UUID.uuid4(),metadata:{extensions:{jupyter_dashboards:{activeView:"grid_default",views:{grid_default:{col:null,height:2,hidden:!0,locked:!0,row:null,width:2}}}}},outputs:[],source:["import os\n","try:\n",`  os.chdir('${e.cwd}')\n`,"except:\n","  pass"]};t.cells=[n,...t.cells]}const n=new F({notebook:t,manager:this.options.manager,rendermime:this.options.rendermime,tracker:this.options.tracker,contentFactory:this.options.contentFactory,mimeTypeService:this.options.mimeTypeService,editorConfig:p.StaticNotebook.defaultEditorConfig,notebookConfig:p.StaticNotebook.defaultNotebookConfig,editorServices:this.options.editorServices});return{panel:new O({id:y.UUID.uuid4(),label:e.title,model:n})}}}class R{async create(e,t){const n=y.UUID.uuid4(),s=o.PageConfig.getOption("baseUrl"),r=c({method:"POST",body:JSON.stringify({method:"request_resources",id:e.id,instanceId:n,labBasePrefix:s})}),a=new i.IFrame({sandbox:["allow-same-origin","allow-scripts","allow-downloads","allow-modals","allow-popups"]}),d=o.PageConfig.getBaseUrl();a.title.label=e.title,a.title.closable=!0,a.disposed.connect((async()=>{await c({method:"POST",body:JSON.stringify({method:"terminate_resources",id:e.id,instanceId:n})})}));const l=new y.PromiseDelegate;return r.then((e=>{a.url=d+e,l.resolve()})),{panel:a,ready:l.promise}}}var j=n(8979);class E{constructor(e){this.options=e}async create(e,t){var n;const o=e.source,i=e.title,s=null===(n=e.args)||void 0===n?void 0:n.reuse,r=e.cwd,{themeManager:a,app:c}=this.options,l=c.serviceManager.terminals;let u;const p=(await d.TerminalAPI.listRunning()).map((e=>e.name));if(!0===s)u=p.includes(i)?l.connectTo({model:{name:i}}):await l.startNew({name:i,cwd:r});else{let e=1,t="";for(;t=`${i}${e}`,p.includes(t);)e+=1;u=await l.startNew({name:t,cwd:r})}const h=new j.Terminal(u,{initialCommand:o,theme:"inherit"});h.title.closable=!0;const m=()=>{h.setOption("theme","inherit")};return null==a||a.themeChanged.connect(m),h.disposed.connect((()=>{null==a||a.themeChanged.disconnect(m)})),{panel:h}}}class U{async create(e,t){const n=e.source;if("string"!=typeof n)return;const o=y.UUID.uuid4(),s={};if(e.args){const t=e.args.sandbox,o=e.args.referrerPolicy;if(e.args.createNewWindow)return void window.open(n,"_blank");t&&(s.sandbox=t),o&&(s.referrerPolicy=o)}const r=new i.IFrame(s);return r.title.label=e.title,r.title.closable=!0,r.disposed.connect((async()=>{await c({method:"POST",body:JSON.stringify({method:"terminate_resources",id:e.id,instanceId:o})})})),r.url=n,{panel:r}}}class W{constructor(){this._isDisposed=!1,this._factoryMap=new Map}registerFactory(e,t){this._factoryMap.has(e)&&console.warn(`Factory for ${e} is already registered, replacing!`),this._factoryMap.set(e,t)}getFactory(e){return this._factoryMap.get(e)}get isDisposed(){return this._isDisposed}dispose(){this._isDisposed}}const A=new y.Token("jupyterlab-app-launcher:IAppTracker"),J=new y.Token("jupyterlab-app-launcher:IPanelFactoryManager");var L=n(8144);const $={id:"jupyter_app_launcher:panel-factory-manager",autoStart:!0,requires:[h.IRenderMimeRegistry,p.INotebookTracker,u.IEditorServices,p.NotebookPanel.IContentFactory,L.IDocumentManager,m.IDefaultFileBrowser],optional:[i.IThemeManager],activate:(e,t,n,o,i,s,r,a)=>{const d=new W,c=new T({manager:e.serviceManager,rendermime:t,tracker:n,contentFactory:i,mimeTypeService:o.mimeTypeService,editorServices:o});d.registerFactory("notebook-grid",c);const l=new k({app:e,documentManager:s,fileBrowser:r});d.registerFactory("notebook",l);const u=new R;d.registerFactory("notebook-voila",u);const p=new w;d.registerFactory("local-server",p);const h=new U;d.registerFactory("url",h);const m=new b({manager:e.serviceManager,rendermime:t});d.registerFactory("markdown",m);const y=new g({commands:e.commands});d.registerFactory("jupyterlab-commands",y);const v=new E({app:e,themeManager:a});return d.registerFactory("terminal",v),d},provides:J};var B=n(4916);function G(e){const t=y.UUID.uuid4(),n=e.split(" ");let o;o=1===n.length?n[0].substring(0,2):`${n[0].substring(0,1)}${n[1].substring(0,1)}`;const i=`<svg class="jp-al-app-icon" width="16" viewBox="0 0 24 24" role="img" xmlns="http://www.w3.org/2000/svg"><text x="0" y="16" fill="#000" style="font-size: 14px">${o.toUpperCase()}</text></svg>`;return new B.LabIcon({name:t,svgstr:i})}function q(e){const t=y.UUID.uuid4();return new B.LabIcon({name:t,svgstr:e})}class H{constructor(e){this.options=e}open(){}icon(){let e;return e=this.options.icon?q(this.options.icon):G(this.options.title),e}label(){return`${this.options.title} (${this.options.type})`}shutdown(){c({method:"POST",body:JSON.stringify({method:"terminate_resources",id:this.options.factoryId,instanceId:this.options.instanceId})}).then((()=>{this.options.tracker.updateRunningInstance()})).catch(console.error)}}class z extends v.DocumentWidget{constructor(e){super(e),this.options=e}dispose(){this.content.dispose(),super.dispose()}get sessionContext(){return this.options.content.sessionContext}}class V extends N.Widget{constructor(e,t){super(),this.addClass("jp-al-NotebookGridDoc"),e.ready.then((async()=>{var n;const o=e.model.toString(),i=null===(n=e.contentsModel)||void 0===n?void 0:n.path,s=null==i?void 0:i.substring(0,i.lastIndexOf("/")+1),r={title:e.path,id:"",sourceCode:o,source:"",cwd:s,type:"notebook-grid"},a=await t.create(r);a&&(this._widget=a.panel,N.Widget.attach(this._widget,this.node))}))}dispose(){var e;this.isDisposed||(null===(e=this._widget)||void 0===e||e.dispose(),a.Signal.clearData(this),super.dispose())}get sessionContext(){var e,t;return null===(t=null===(e=this._widget)||void 0===e?void 0:e.model.context)||void 0===t?void 0:t.sessionContext}get model(){var e,t;return null===(t=null===(e=this._widget)||void 0===e?void 0:e.model.context)||void 0===t?void 0:t.model}}class Y extends v.ABCWidgetFactory{constructor(e){super(e),this._notebookGridFactory=e.notebookGridFactory}createNewWidget(e){return new z({context:e,content:new V(e,this._notebookGridFactory)})}}const K=new y.Token("exampleDocTracker"),Q={id:"jupyter_app_launcher:notebookGrid",autoStart:!0,requires:[h.IRenderMimeRegistry,p.INotebookTracker,u.IEditorServices,p.NotebookPanel.IContentFactory],activate:(e,t,n,o,s)=>{const r=new i.WidgetTracker({namespace:"notebook-grid"}),a=new T({manager:e.serviceManager,rendermime:t,tracker:n,contentFactory:s,mimeTypeService:o.mimeTypeService,editorServices:o}),d=new Y({name:"Notebook GridStack",modelName:"notebook",fileTypes:["ipynb"],notebookGridFactory:a});e.docRegistry.addWidgetFactory(d);const c=new p.NotebookModelFactory({});return e.docRegistry.addModelFactory(c),e.docRegistry.addFileType({name:"ipynb",displayName:"IPYNB",mimeTypes:["text/json"],extensions:[".ipynb",".IPYNB"],fileFormat:"json",contentType:"notebook"}),d.widgetCreated.connect(((e,t)=>{t.context.pathChanged.connect((()=>{r.save(t)})),r.add(t)})),r},provides:K},X=[$,{id:"jupyter_app_launcher:plugin",autoStart:!0,requires:[s.ILauncher,J],optional:[r.IRunningSessionManagers],activate:async function(e,t,n,s){console.log("JupyterLab extension jupyter_app_launcher is activated!");const{commands:r}=e,a=o.PageConfig.getOption("appName"),d=new l({namespace:"jupyterlab-app-launcher"},a);if((await async function(e){let t=[];if("JupyterLite"===e){const e=o.PageConfig.getOption("settingsOverrides");e.length>0&&(t=JSON.parse(e).appLauncherData.config)}else t=await c({method:"POST",body:JSON.stringify({method:"init_launcher"})});return t}(a)).forEach(((o,s)=>function(o,s){var a;let c;c=o.icon?q(o.icon):G(o.title),r.addCommand(o.id,{label:o.title,caption:o.description,icon:c,execute:async t=>{const s=n.getFactory(o.type);if(!s)return;const r=new N.BoxPanel({direction:"top-to-bottom",spacing:0}),a=new y.PromiseDelegate;let c=!1;if(("notebook"===o.type||"jupyterlab-commands"===o.type||"url"===o.type&&o.args.createNewWindow)&&(c=!0),!c){r.title.label=o.title;const t=new i.MainAreaWidget({content:r,reveal:a.promise});t.addClass("jp-Document"),e.shell.add(t,"main")}s.create(o,t).then((e=>{if(e){const{panel:t,ready:n}=e;r.addWidget(t),d.add(t),d.save(t),n?n.then((()=>a.resolve(void 0))):a.resolve(void 0)}})).catch(console.error)}}),t.add({command:o.id,category:null!==(a=o.catalog)&&void 0!==a?a:"Jupyter App",rank:s})}(o,s))),"JupyterLite"!==a&&(await d.updateRunningInstance(),s)){let e=[];s.add({name:"Launcher application",running:()=>(e=d.runningInstance.map((e=>new H({factoryId:e.factory_id,instanceId:e.instance_id,title:e.config.title,type:e.config.type,tracker:d}))),e),shutdownAll:()=>{e.forEach((e=>{e.shutdown()}))},refreshRunning:()=>{},runningChanged:d.instanceChanged,shutdownLabel:"Shut Down",shutdownAllLabel:"Shut Down All",shutdownAllConfirmationText:"Are you sure you want to permanently shut down all running applications?"})}return d},provides:A},Q]}}]);