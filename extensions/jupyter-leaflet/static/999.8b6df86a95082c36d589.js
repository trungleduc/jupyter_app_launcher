/*! For license information please see 999.8b6df86a95082c36d589.js.LICENSE.txt */
"use strict";(self.webpackChunkjupyter_leaflet=self.webpackChunkjupyter_leaflet||[]).push([[999],{4999:(t,e,i)=>{i.r(e),i.d(e,{CenteredSymbolizer:()=>li,CenteredTextSymbolizer:()=>ui,CircleSymbolizer:()=>ri,FlexSymbolizer:()=>ai,Font:()=>Bi,GeomType:()=>Dt,GroupSymbolizer:()=>oi,IconSymbolizer:()=>ii,Index:()=>le,Justify:()=>Fe,Labeler:()=>he,Labelers:()=>fe,LineLabelPlacement:()=>Qe,LineLabelSymbolizer:()=>pi,LineSymbolizer:()=>ei,OffsetSymbolizer:()=>di,OffsetTextSymbolizer:()=>ci,PMTiles:()=>Pt,Padding:()=>hi,PmtilesSource:()=>It,PolygonLabelSymbolizer:()=>yi,PolygonSymbolizer:()=>qe,Sheet:()=>Yi,ShieldSymbolizer:()=>ni,Static:()=>Fi,TextPlacements:()=>Ce,TextSymbolizer:()=>fi,TileCache:()=>Gt,Toner:()=>Ui,View:()=>ee,ZxySource:()=>At,arr:()=>$e,covering:()=>oe,createPattern:()=>Oe,cubicBezier:()=>Ge,dark:()=>de,exp:()=>Ke,filterFn:()=>Pi,getFont:()=>Ii,getZoom:()=>Li,isCCW:()=>Zt,isInRing:()=>Nt,json_style:()=>Ai,labelRules:()=>xi,leafletLayer:()=>Ti,light:()=>ue,linear:()=>Je,numberFn:()=>ji,numberOrFn:()=>Ei,paintRules:()=>gi,painter:()=>ne,pointInPolygon:()=>Kt,pointMinDistToLines:()=>Jt,pointMinDistToPoints:()=>Ht,sourcesToViews:()=>ie,step:()=>He,toIndex:()=>jt,transformGeom:()=>Qt,widthFn:()=>Vi,wrap:()=>te});var r=Object.create,n=Object.defineProperty,a=Object.getOwnPropertyDescriptor,s=Object.getOwnPropertyNames,o=Object.getOwnPropertySymbols,l=Object.getPrototypeOf,h=Object.prototype.hasOwnProperty,f=Object.prototype.propertyIsEnumerable,u=(t,e,i)=>e in t?n(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,d=(t,e)=>function(){return e||(0,t[Object.keys(t)[0]])((e={exports:{}}).exports,e),e.exports},c=t=>{return((t,e,i)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let r of s(e))h.call(t,r)||"default"===r||n(t,r,{get:()=>e[r],enumerable:!(i=a(e,r))||i.enumerable});return t})((e=n(null!=t?r(l(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0}),n(e,"__esModule",{value:!0})),t);var e},p=(t,e,i)=>new Promise(((r,n)=>{var a=t=>{try{o(i.next(t))}catch(t){n(t)}},s=t=>{try{o(i.throw(t))}catch(t){n(t)}},o=t=>t.done?r(t.value):Promise.resolve(t.value).then(a,s);o((i=i.apply(t,e)).next())})),y=d({"node_modules/@mapbox/point-geometry/index.js"(t,e){function i(t,e){this.x=t,this.y=e}e.exports=i,i.prototype={clone:function(){return new i(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,i=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=i,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),r=e*this.x-i*this.y,n=i*this.x+e*this.y;return this.x=r,this.y=n,this},_rotateAround:function(t,e){var i=Math.cos(t),r=Math.sin(t),n=e.x+i*(this.x-e.x)-r*(this.y-e.y),a=e.y+r*(this.x-e.x)+i*(this.y-e.y);return this.x=n,this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},i.convert=function(t){return t instanceof i?t:Array.isArray(t)?new i(t[0],t[1]):t}}}),m=d({"node_modules/@mapbox/vector-tile/lib/vectortilefeature.js"(t,e){var i=y();function r(t,e,i,r,a){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=a,t.readFields(n,this,e)}function n(t,e,i){1==t?e.id=i.readVarint():2==t?function(t,e){for(var i=t.readVarint()+t.pos;t.pos<i;){var r=e._keys[t.readVarint()],n=e._values[t.readVarint()];e.properties[r]=n}}(i,e):3==t?e.type=i.readVarint():4==t&&(e._geometry=i.pos)}function a(t){for(var e,i,r=0,n=0,a=t.length,s=a-1;n<a;s=n++)e=t[n],r+=((i=t[s]).x-e.x)*(e.y+i.y);return r}e.exports=r,r.types=["Unknown","Point","LineString","Polygon"],r.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r=t.readVarint()+t.pos,n=1,a=0,s=0,o=0,l=[];t.pos<r;){if(a<=0){var h=t.readVarint();n=7&h,a=h>>3}if(a--,1===n||2===n)s+=t.readSVarint(),o+=t.readSVarint(),1===n&&(e&&l.push(e),e=[]),e.push(new i(s,o));else{if(7!==n)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&l.push(e),l},r.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,r=0,n=0,a=0,s=1/0,o=-1/0,l=1/0,h=-1/0;t.pos<e;){if(r<=0){var f=t.readVarint();i=7&f,r=f>>3}if(r--,1===i||2===i)(n+=t.readSVarint())<s&&(s=n),n>o&&(o=n),(a+=t.readSVarint())<l&&(l=a),a>h&&(h=a);else if(7!==i)throw new Error("unknown command "+i)}return[s,l,o,h]},r.prototype.toGeoJSON=function(t,e,i){var n,s,o=this.extent*Math.pow(2,i),l=this.extent*t,h=this.extent*e,f=this.loadGeometry(),u=r.types[this.type];function d(t){for(var e=0;e<t.length;e++){var i=t[e],r=180-360*(i.y+h)/o;t[e]=[360*(i.x+l)/o-180,360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90]}}switch(this.type){case 1:var c=[];for(n=0;n<f.length;n++)c[n]=f[n][0];d(f=c);break;case 2:for(n=0;n<f.length;n++)d(f[n]);break;case 3:for(f=function(t){var e=t.length;if(e<=1)return[t];for(var i,r,n=[],s=0;s<e;s++){var o=a(t[s]);0!==o&&(void 0===r&&(r=o<0),r===o<0?(i&&n.push(i),i=[t[s]]):i.push(t[s]))}return i&&n.push(i),n}(f),n=0;n<f.length;n++)for(s=0;s<f[n].length;s++)d(f[n][s])}1===f.length?f=f[0]:u="Multi"+u;var p={type:"Feature",geometry:{type:u,coordinates:f},properties:this.properties};return"id"in this&&(p.id=this.id),p}}}),g=d({"node_modules/@mapbox/vector-tile/lib/vectortilelayer.js"(t,e){var i=m();function r(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(n,this,e),this.length=this._features.length}function n(t,e,i){15===t?e.version=i.readVarint():1===t?e.name=i.readString():5===t?e.extent=i.readVarint():2===t?e._features.push(i.pos):3===t?e._keys.push(i.readString()):4===t&&e._values.push(function(t){for(var e=null,i=t.readVarint()+t.pos;t.pos<i;){var r=t.readVarint()>>3;e=1===r?t.readString():2===r?t.readFloat():3===r?t.readDouble():4===r?t.readVarint64():5===r?t.readVarint():6===r?t.readSVarint():7===r?t.readBoolean():null}return e}(i))}e.exports=r,r.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new i(this._pbf,e,this.extent,this._keys,this._values)}}}),x=d({"node_modules/@mapbox/vector-tile/lib/vectortile.js"(t,e){var i=g();function r(t,e,r){if(3===t){var n=new i(r,r.readVarint()+r.pos);n.length&&(e[n.name]=n)}}e.exports=function(t,e){this.layers=t.readFields(r,{},e)}}}),w=d({"node_modules/@mapbox/vector-tile/index.js"(t,e){e.exports.VectorTile=x(),e.exports.VectorTileFeature=m(),e.exports.VectorTileLayer=g()}}),b=d({"node_modules/ieee754/index.js"(t){t.read=function(t,e,i,r,n){var a,s,o=8*n-r-1,l=(1<<o)-1,h=l>>1,f=-7,u=i?n-1:0,d=i?-1:1,c=t[e+u];for(u+=d,a=c&(1<<-f)-1,c>>=-f,f+=o;f>0;a=256*a+t[e+u],u+=d,f-=8);for(s=a&(1<<-f)-1,a>>=-f,f+=r;f>0;s=256*s+t[e+u],u+=d,f-=8);if(0===a)a=1-h;else{if(a===l)return s?NaN:1/0*(c?-1:1);s+=Math.pow(2,r),a-=h}return(c?-1:1)*s*Math.pow(2,a-r)},t.write=function(t,e,i,r,n,a){var s,o,l,h=8*a-n-1,f=(1<<h)-1,u=f>>1,d=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,c=r?0:a-1,p=r?1:-1,y=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(o=isNaN(e)?1:0,s=f):(s=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-s))<1&&(s--,l*=2),(e+=s+u>=1?d/l:d*Math.pow(2,1-u))*l>=2&&(s++,l/=2),s+u>=f?(o=0,s=f):s+u>=1?(o=(e*l-1)*Math.pow(2,n),s+=u):(o=e*Math.pow(2,u-1)*Math.pow(2,n),s=0));n>=8;t[i+c]=255&o,c+=p,o/=256,n-=8);for(s=s<<n|o,h+=n;h>0;t[i+c]=255&s,c+=p,s/=256,h-=8);t[i+c-p]|=128*y}}}),v=d({"node_modules/pbf/index.js"(t,e){e.exports=r;var i=b();function r(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}r.Varint=0,r.Fixed64=1,r.Bytes=2,r.Fixed32=5;var n=4294967296,a=1/n,s="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function o(t){return t.type===r.Bytes?t.readVarint()+t.pos:t.pos+1}function l(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function h(t,e,i){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(r);for(var n=i.pos-1;n>=t;n--)i.buf[n+r]=i.buf[n]}function f(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function u(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function d(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function c(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function p(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function y(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function m(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function g(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function x(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function w(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function v(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function _(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}r.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),n=r>>3,a=this.pos;this.type=7&r,t(n,e,this),this.pos===a&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=w(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=_(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=w(this.buf,this.pos)+w(this.buf,this.pos+4)*n;return this.pos+=8,t},readSFixed64:function(){var t=w(this.buf,this.pos)+_(this.buf,this.pos+4)*n;return this.pos+=8,t},readFloat:function(){var t=i.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=i.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,r=this.buf;return e=127&(i=r[this.pos++]),i<128?e:(e|=(127&(i=r[this.pos++]))<<7,i<128?e:(e|=(127&(i=r[this.pos++]))<<14,i<128?e:(e|=(127&(i=r[this.pos++]))<<21,i<128?e:function(t,e,i){var r,n,a=i.buf;if(r=(112&(n=a[i.pos++]))>>4,n<128)return l(t,r,e);if(r|=(127&(n=a[i.pos++]))<<3,n<128)return l(t,r,e);if(r|=(127&(n=a[i.pos++]))<<10,n<128)return l(t,r,e);if(r|=(127&(n=a[i.pos++]))<<17,n<128)return l(t,r,e);if(r|=(127&(n=a[i.pos++]))<<24,n<128)return l(t,r,e);if(r|=(1&(n=a[i.pos++]))<<31,n<128)return l(t,r,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=r[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&s?function(t,e,i){return s.decode(t.subarray(e,i))}(this.buf,e,t):function(t,e,i){for(var r="",n=e;n<i;){var a,s,o,l=t[n],h=null,f=l>239?4:l>223?3:l>191?2:1;if(n+f>i)break;1===f?l<128&&(h=l):2===f?128==(192&(a=t[n+1]))&&(h=(31&l)<<6|63&a)<=127&&(h=null):3===f?(a=t[n+1],s=t[n+2],128==(192&a)&&128==(192&s)&&((h=(15&l)<<12|(63&a)<<6|63&s)<=2047||h>=55296&&h<=57343)&&(h=null)):4===f&&(a=t[n+1],s=t[n+2],o=t[n+3],128==(192&a)&&128==(192&s)&&128==(192&o)&&((h=(15&l)<<18|(63&a)<<12|(63&s)<<6|63&o)<=65535||h>=1114112)&&(h=null)),null===h?(h=65533,f=1):h>65535&&(h-=65536,r+=String.fromCharCode(h>>>10&1023|55296),h=56320|1023&h),r+=String.fromCharCode(h),n+=f}return r}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==r.Bytes)return t.push(this.readVarint(e));var i=o(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==r.Bytes)return t.push(this.readSVarint());var e=o(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==r.Bytes)return t.push(this.readBoolean());var e=o(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==r.Bytes)return t.push(this.readFloat());var e=o(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==r.Bytes)return t.push(this.readDouble());var e=o(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==r.Bytes)return t.push(this.readFixed32());var e=o(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==r.Bytes)return t.push(this.readSFixed32());var e=o(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==r.Bytes)return t.push(this.readFixed64());var e=o(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==r.Bytes)return t.push(this.readSFixed64());var e=o(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===r.Varint)for(;this.buf[this.pos++]>127;);else if(e===r.Bytes)this.pos=this.readVarint()+this.pos;else if(e===r.Fixed32)this.pos+=4;else{if(e!==r.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),v(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),v(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),v(this.buf,-1&t,this.pos),v(this.buf,Math.floor(t*a),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),v(this.buf,-1&t,this.pos),v(this.buf,Math.floor(t*a),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var i,r;if(t>=0?(i=t%4294967296|0,r=t/4294967296|0):(r=~(-t/4294967296),4294967295^(i=~(-t%4294967296))?i=i+1|0:(i=0,r=r+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,i){i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos]=127&t}(i,0,e),function(t,e){var i=(7&t)<<4;e.buf[e.pos++]|=i|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(r,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,i){for(var r,n,a=0;a<e.length;a++){if((r=e.charCodeAt(a))>55295&&r<57344){if(!n){r>56319||a+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):n=r;continue}if(r<56320){t[i++]=239,t[i++]=191,t[i++]=189,n=r;continue}r=n-55296<<10|r-56320|65536,n=null}else n&&(t[i++]=239,t[i++]=191,t[i++]=189,n=null);r<128?t[i++]=r:(r<2048?t[i++]=r>>6|192:(r<65536?t[i++]=r>>12|224:(t[i++]=r>>18|240,t[i++]=r>>12&63|128),t[i++]=r>>6&63|128),t[i++]=63&r|128)}return i}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&h(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),i.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),i.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var r=this.pos-i;r>=128&&h(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,i){this.writeTag(t,r.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,f,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,u,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,p,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,d,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,c,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,y,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,m,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,g,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,x,e)},writeBytesField:function(t,e){this.writeTag(t,r.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,r.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,r.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,r.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,r.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,r.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,r.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,r.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,r.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,r.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}}}}),_=d({"node_modules/rbush/rbush.min.js"(t,e){var r,n;r=t,n=function(){function t(t,r,n,a,s){!function t(i,r,n,a,s){for(;a>n;){if(a-n>600){var o=a-n+1,l=r-n+1,h=Math.log(o),f=.5*Math.exp(2*h/3),u=.5*Math.sqrt(h*f*(o-f)/o)*(l-o/2<0?-1:1);t(i,r,Math.max(n,Math.floor(r-l*f/o+u)),Math.min(a,Math.floor(r+(o-l)*f/o+u)),s)}var d=i[r],c=n,p=a;for(e(i,n,r),s(i[a],d)>0&&e(i,n,a);c<p;){for(e(i,c,p),c++,p--;s(i[c],d)<0;)c++;for(;s(i[p],d)>0;)p--}0===s(i[n],d)?e(i,n,p):e(i,++p,a),p<=r&&(n=p+1),r<=p&&(a=p-1)}}(t,r,n||0,a||t.length-1,s||i)}function e(t,e,i){var r=t[e];t[e]=t[i],t[i]=r}function i(t,e){return t<e?-1:t>e?1:0}var r=function(t){void 0===t&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function n(t,e,i){if(!i)return e.indexOf(t);for(var r=0;r<e.length;r++)if(i(t,e[r]))return r;return-1}function a(t,e){s(t,0,t.children.length,e,t)}function s(t,e,i,r,n){n||(n=p(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(var a=e;a<i;a++){var s=t.children[a];o(n,t.leaf?r(s):s)}return n}function o(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function l(t,e){return t.minX-e.minX}function h(t,e){return t.minY-e.minY}function f(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function u(t){return t.maxX-t.minX+(t.maxY-t.minY)}function d(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function c(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function p(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function y(e,i,r,n,a){for(var s=[i,r];s.length;)if(!((r=s.pop())-(i=s.pop())<=n)){var o=i+Math.ceil((r-i)/n/2)*n;t(e,o,i,r,a),s.push(i,o,o,r)}}return r.prototype.all=function(){return this._all(this.data,[])},r.prototype.search=function(t){var e=this.data,i=[];if(!c(t,e))return i;for(var r=this.toBBox,n=[];e;){for(var a=0;a<e.children.length;a++){var s=e.children[a],o=e.leaf?r(s):s;c(t,o)&&(e.leaf?i.push(s):d(t,o)?this._all(s,i):n.push(s))}e=n.pop()}return i},r.prototype.collides=function(t){var e=this.data;if(!c(t,e))return!1;for(var i=[];e;){for(var r=0;r<e.children.length;r++){var n=e.children[r],a=e.leaf?this.toBBox(n):n;if(c(t,a)){if(e.leaf||d(t,a))return!0;i.push(n)}}e=i.pop()}return!1},r.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0;e<t.length;e++)this.insert(t[e]);return this}var i=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var r=this.data;this.data=i,i=r}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},r.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},r.prototype.clear=function(){return this.data=p([]),this},r.prototype.remove=function(t,e){if(!t)return this;for(var i,r,a,s=this.data,o=this.toBBox(t),l=[],h=[];s||l.length;){if(s||(s=l.pop(),r=l[l.length-1],i=h.pop(),a=!0),s.leaf){var f=n(t,s.children,e);if(-1!==f)return s.children.splice(f,1),l.push(s),this._condense(l),this}a||s.leaf||!d(s,o)?r?(i++,s=r.children[i],a=!1):s=null:(l.push(s),h.push(i),i=0,r=s,s=s.children[0])}return this},r.prototype.toBBox=function(t){return t},r.prototype.compareMinX=function(t,e){return t.minX-e.minX},r.prototype.compareMinY=function(t,e){return t.minY-e.minY},r.prototype.toJSON=function(){return this.data},r.prototype.fromJSON=function(t){return this.data=t,this},r.prototype._all=function(t,e){for(var i=[];t;)t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e},r.prototype._build=function(t,e,i,r){var n,s=i-e+1,o=this._maxEntries;if(s<=o)return a(n=p(t.slice(e,i+1)),this.toBBox),n;r||(r=Math.ceil(Math.log(s)/Math.log(o)),o=Math.ceil(s/Math.pow(o,r-1))),(n=p([])).leaf=!1,n.height=r;var l=Math.ceil(s/o),h=l*Math.ceil(Math.sqrt(o));y(t,e,i,h,this.compareMinX);for(var f=e;f<=i;f+=h){var u=Math.min(f+h-1,i);y(t,f,u,l,this.compareMinY);for(var d=f;d<=u;d+=l){var c=Math.min(d+l-1,u);n.children.push(this._build(t,d,c,r-1))}}return a(n,this.toBBox),n},r.prototype._chooseSubtree=function(t,e,i,r){for(;r.push(e),!e.leaf&&r.length-1!==i;){for(var n=1/0,a=1/0,s=void 0,o=0;o<e.children.length;o++){var l=e.children[o],h=f(l),u=(d=t,c=l,(Math.max(c.maxX,d.maxX)-Math.min(c.minX,d.minX))*(Math.max(c.maxY,d.maxY)-Math.min(c.minY,d.minY))-h);u<a?(a=u,n=h<n?h:n,s=l):u===a&&h<n&&(n=h,s=l)}e=s||e.children[0]}var d,c;return e},r.prototype._insert=function(t,e,i){var r=i?t:this.toBBox(t),n=[],a=this._chooseSubtree(r,this.data,e,n);for(a.children.push(t),o(a,r);e>=0&&n[e].children.length>this._maxEntries;)this._split(n,e),e--;this._adjustParentBBoxes(r,n,e)},r.prototype._split=function(t,e){var i=t[e],r=i.children.length,n=this._minEntries;this._chooseSplitAxis(i,n,r);var s=this._chooseSplitIndex(i,n,r),o=p(i.children.splice(s,i.children.length-s));o.height=i.height,o.leaf=i.leaf,a(i,this.toBBox),a(o,this.toBBox),e?t[e-1].children.push(o):this._splitRoot(i,o)},r.prototype._splitRoot=function(t,e){this.data=p([t,e]),this.data.height=t.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},r.prototype._chooseSplitIndex=function(t,e,i){for(var r,n,a,o,l,h,u,d=1/0,c=1/0,p=e;p<=i-e;p++){var y=s(t,0,p,this.toBBox),m=s(t,p,i,this.toBBox),g=(n=y,a=m,o=Math.max(n.minX,a.minX),l=Math.max(n.minY,a.minY),h=Math.min(n.maxX,a.maxX),u=Math.min(n.maxY,a.maxY),Math.max(0,h-o)*Math.max(0,u-l)),x=f(y)+f(m);g<d?(d=g,r=p,c=x<c?x:c):g===d&&x<c&&(c=x,r=p)}return r||i-e},r.prototype._chooseSplitAxis=function(t,e,i){var r=t.leaf?this.compareMinX:l,n=t.leaf?this.compareMinY:h;this._allDistMargin(t,e,i,r)<this._allDistMargin(t,e,i,n)&&t.children.sort(r)},r.prototype._allDistMargin=function(t,e,i,r){t.children.sort(r);for(var n=this.toBBox,a=s(t,0,e,n),l=s(t,i-e,i,n),h=u(a)+u(l),f=e;f<i-e;f++){var d=t.children[f];o(a,t.leaf?n(d):d),h+=u(a)}for(var c=i-e-1;c>=e;c--){var p=t.children[c];o(l,t.leaf?n(p):p),h+=u(l)}return h},r.prototype._adjustParentBBoxes=function(t,e,i){for(var r=i;r>=0;r--)o(e[r],t)},r.prototype._condense=function(t){for(var e=t.length-1,i=void 0;e>=0;e--)0===t[e].children.length?e>0?(i=t[e-1].children).splice(i.indexOf(t[e]),1):this.clear():a(t[e],this.toBBox)},r},"object"==typeof t&&void 0!==e?e.exports=n():"function"==typeof define&&i.amdO?define(n):(r=r||self).RBush=n()}}),z=d({"src/types/unitbezier.d.ts"(){}}),k=d({"node_modules/tinyqueue/tinyqueue.js"(t,e){var r,n;r=t,n=function(){var t=function(t,i){if(void 0===t&&(t=[]),void 0===i&&(i=e),this.data=t,this.length=this.data.length,this.compare=i,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)};function e(t,e){return t<e?-1:t>e?1:0}return t.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},t.prototype.pop=function(){if(0!==this.length){var t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}},t.prototype.peek=function(){return this.data[0]},t.prototype._up=function(t){for(var e=this.data,i=this.compare,r=e[t];t>0;){var n=t-1>>1,a=e[n];if(i(r,a)>=0)break;e[t]=a,t=n}e[t]=r},t.prototype._down=function(t){for(var e=this.data,i=this.compare,r=this.length>>1,n=e[t];t<r;){var a=1+(t<<1),s=e[a],o=a+1;if(o<this.length&&i(e[o],s)<0&&(a=o,s=e[o]),i(s,n)>=0)break;e[t]=s,t=a}e[t]=n},t},"object"==typeof t&&void 0!==e?e.exports=n():"function"==typeof define&&i.amdO?define(n):(r=r||self).TinyQueue=n()}}),M=d({"node_modules/polylabel/polylabel.js"(t,e){var i=k();function r(t,e,r){var s,o,l,h;e=e||1;for(var f=0;f<t[0].length;f++){var u=t[0][f];(!f||u[0]<s)&&(s=u[0]),(!f||u[1]<o)&&(o=u[1]),(!f||u[0]>l)&&(l=u[0]),(!f||u[1]>h)&&(h=u[1])}var d=l-s,c=h-o,p=Math.min(d,c),y=p/2;if(0===p){var m=[s,o];return m.distance=0,m}for(var g=new i(void 0,n),x=s;x<l;x+=p)for(var w=o;w<h;w+=p)g.push(new a(x+y,w+y,y,t));var b=function(t){for(var e=0,i=0,r=0,n=t[0],s=0,o=n.length,l=o-1;s<o;l=s++){var h=n[s],f=n[l],u=h[0]*f[1]-f[0]*h[1];i+=(h[0]+f[0])*u,r+=(h[1]+f[1])*u,e+=3*u}return 0===e?new a(n[0][0],n[0][1],0,t):new a(i/e,r/e,0,t)}(t),v=new a(s+d/2,o+c/2,0,t);v.d>b.d&&(b=v);for(var _=g.length;g.length;){var z=g.pop();z.d>b.d&&(b=z,r&&console.log("found best %d after %d probes",Math.round(1e4*z.d)/1e4,_)),z.max-b.d<=e||(y=z.h/2,g.push(new a(z.x-y,z.y-y,y,t)),g.push(new a(z.x+y,z.y-y,y,t)),g.push(new a(z.x-y,z.y+y,y,t)),g.push(new a(z.x+y,z.y+y,y,t)),_+=4)}r&&(console.log("num probes: "+_),console.log("best distance: "+b.d));var k=[b.x,b.y];return k.distance=b.d,k}function n(t,e){return e.max-t.max}function a(t,e,i,r){this.x=t,this.y=e,this.h=i,this.d=function(t,e,i){for(var r=!1,n=1/0,a=0;a<i.length;a++)for(var o=i[a],l=0,h=o.length,f=h-1;l<h;f=l++){var u=o[l],d=o[f];u[1]>e!=d[1]>e&&t<(d[0]-u[0])*(e-u[1])/(d[1]-u[1])+u[0]&&(r=!r),n=Math.min(n,s(t,e,u,d))}return 0===n?0:(r?1:-1)*Math.sqrt(n)}(t,e,r),this.max=this.d+this.h*Math.SQRT2}function s(t,e,i,r){var n=i[0],a=i[1],s=r[0]-n,o=r[1]-a;if(0!==s||0!==o){var l=((t-n)*s+(e-a)*o)/(s*s+o*o);l>1?(n=r[0],a=r[1]):l>0&&(n+=s*l,a+=o*l)}return(s=t-n)*s+(o=e-a)*o}i.default&&(i=i.default),e.exports=r,e.exports.default=r}}),F=c(y()),S=c(y()),C=c(y()),T=c(w()),B=c(v()),D=(t,e,i)=>new Promise(((r,n)=>{var a=t=>{try{o(i.next(t))}catch(t){n(t)}},s=t=>{try{o(i.throw(t))}catch(t){n(t)}},o=t=>t.done?r(t.value):Promise.resolve(t.value).then(a,s);o((i=i.apply(t,e)).next())})),Y=Uint8Array,X=Uint16Array,P=Uint32Array,j=new Y([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),E=new Y([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),V=new Y([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),I=function(t,e){for(var i=new X(31),r=0;r<31;++r)i[r]=e+=1<<t[r-1];var n=new P(i[30]);for(r=1;r<30;++r)for(var a=i[r];a<i[r+1];++a)n[a]=a-i[r]<<5|r;return[i,n]},A=I(j,2),U=A[0],R=A[1];U[28]=258,R[258]=28;var O,q=I(E,0),$=q[0],W=(q[1],new X(32768));for(K=0;K<32768;++K)O=(61680&(O=(52428&(O=(43690&K)>>>1|(21845&K)<<1))>>>2|(13107&O)<<2))>>>4|(3855&O)<<4,W[K]=((65280&O)>>>8|(255&O)<<8)>>>1;var N=function(t,e,i){for(var r=t.length,n=0,a=new X(e);n<r;++n)t[n]&&++a[t[n]-1];var s,o=new X(e);for(n=0;n<e;++n)o[n]=o[n-1]+a[n-1]<<1;if(i){s=new X(1<<e);var l=15-e;for(n=0;n<r;++n)if(t[n])for(var h=n<<4|t[n],f=e-t[n],u=o[t[n]-1]++<<f,d=u|(1<<f)-1;u<=d;++u)s[W[u]>>>l]=h}else for(s=new X(r),n=0;n<r;++n)t[n]&&(s[n]=W[o[t[n]-1]++]>>>15-t[n]);return s},Z=new Y(288);for(K=0;K<144;++K)Z[K]=8;for(K=144;K<256;++K)Z[K]=9;for(K=256;K<280;++K)Z[K]=7;for(K=280;K<288;++K)Z[K]=8;var K,H=new Y(32);for(K=0;K<32;++K)H[K]=5;var J=N(Z,9,1),G=N(H,5,1),Q=function(t){for(var e=t[0],i=1;i<t.length;++i)t[i]>e&&(e=t[i]);return e},tt=function(t,e,i){var r=e/8|0;return(t[r]|t[r+1]<<8)>>(7&e)&i},et=function(t,e){var i=e/8|0;return(t[i]|t[i+1]<<8|t[i+2]<<16)>>(7&e)},it=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],rt=function(t,e,i){var r=new Error(e||it[t]);if(r.code=t,Error.captureStackTrace&&Error.captureStackTrace(r,rt),!i)throw r;return r},nt=function(t,e,i){var r=t.length;if(!r||i&&i.f&&!i.l)return e||new Y(0);var n=!e||i,a=!i||i.i;i||(i={}),e||(e=new Y(3*r));var s=function(t){var i=e.length;if(t>i){var r=new Y(Math.max(2*i,t));r.set(e),e=r}},o=i.f||0,l=i.p||0,h=i.b||0,f=i.l,u=i.d,d=i.m,c=i.n,p=8*r;do{if(!f){o=tt(t,l,1);var y=tt(t,l+1,3);if(l+=3,!y){var m=t[(F=4+((l+7)/8|0))-4]|t[F-3]<<8,g=F+m;if(g>r){a&&rt(0);break}n&&s(h+m),e.set(t.subarray(F,g),h),i.b=h+=m,i.p=l=8*g,i.f=o;continue}if(1==y)f=J,u=G,d=9,c=5;else if(2==y){var x=tt(t,l,31)+257,w=tt(t,l+10,15)+4,b=x+tt(t,l+5,31)+1;l+=14;for(var v=new Y(b),_=new Y(19),z=0;z<w;++z)_[V[z]]=tt(t,l+3*z,7);l+=3*w;var k=Q(_),M=(1<<k)-1,L=N(_,k,1);for(z=0;z<b;){var F,S=L[tt(t,l,M)];if(l+=15&S,(F=S>>>4)<16)v[z++]=F;else{var C=0,T=0;for(16==F?(T=3+tt(t,l,3),l+=2,C=v[z-1]):17==F?(T=3+tt(t,l,7),l+=3):18==F&&(T=11+tt(t,l,127),l+=7);T--;)v[z++]=C}}var B=v.subarray(0,x),D=v.subarray(x);d=Q(B),c=Q(D),f=N(B,d,1),u=N(D,c,1)}else rt(1);if(l>p){a&&rt(0);break}}n&&s(h+131072);for(var I=(1<<d)-1,A=(1<<c)-1,R=l;;R=l){var O=(C=f[et(t,l)&I])>>>4;if((l+=15&C)>p){a&&rt(0);break}if(C||rt(2),O<256)e[h++]=O;else{if(256==O){R=l,f=null;break}var q=O-254;if(O>264){var W=j[z=O-257];q=tt(t,l,(1<<W)-1)+U[z],l+=W}var Z=u[et(t,l)&A],K=Z>>>4;if(Z||rt(3),l+=15&Z,D=$[K],K>3&&(W=E[K],D+=et(t,l)&(1<<W)-1,l+=W),l>p){a&&rt(0);break}n&&s(h+131072);for(var H=h+q;h<H;h+=4)e[h]=e[h-D],e[h+1]=e[h+1-D],e[h+2]=e[h+2-D],e[h+3]=e[h+3-D];h=H}}i.l=f,i.p=R,i.b=h,i.f=o,f&&(o=1,i.m=d,i.d=u,i.n=c)}while(!o);return h==e.length?e:function(t,e,i){(null==e||e<0)&&(e=0),(null==i||i>t.length)&&(i=t.length);var r=new(2==t.BYTES_PER_ELEMENT?X:4==t.BYTES_PER_ELEMENT?P:Y)(i-e);return r.set(t.subarray(e,i)),r}(e,0,h)},at=new Y(0),st=function(t){31==t[0]&&139==t[1]&&8==t[2]||rt(6,"invalid gzip data");var e=t[3],i=10;4&e&&(i+=t[10]|2+(t[11]<<8));for(var r=(e>>3&1)+(e>>4&1);r>0;r-=!t[i++]);return i+(2&e)},ot=function(t){var e=t.length;return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0},lt=function(t){(8!=(15&t[0])||t[0]>>>4>7||(t[0]<<8|t[1])%31)&&rt(6,"invalid zlib data"),32&t[1]&&rt(6,"invalid zlib data: preset dictionaries not supported")};function ht(t,e){return 31==t[0]&&139==t[1]&&8==t[2]?function(t,e){return nt(t.subarray(st(t),-8),e||new Y(ot(t)))}(t,e):8!=(15&t[0])||t[0]>>4>7||(t[0]<<8|t[1])%31?function(t,e){return nt(t,e)}(t,e):function(t,e){return nt((lt(t),t.subarray(2,-4)),e)}(t,e)}var ft="undefined"!=typeof TextDecoder&&new TextDecoder;try{ft.decode(at,{stream:!0})}catch(t){}var ut=(t,e)=>t*Math.pow(2,e),dt=(t,e)=>Math.floor(t/Math.pow(2,e)),ct=(t,e)=>ut(t.getUint16(e+1,!0),8)+t.getUint8(e),pt=(t,e)=>ut(t.getUint32(e+2,!0),16)+t.getUint16(e,!0),yt=(t,e,i,r,n)=>{if(t!=r.getUint8(n))return t-r.getUint8(n);const a=ct(r,n+1);if(e!=a)return e-a;const s=ct(r,n+4);return i!=s?i-s:0},mt=(t,e,i,r)=>{const n=gt(t,e,i,r);return n?{z:e,x:i,y:r,offset:n[0],length:n[1],is_dir:!1}:null},gt=(t,e,i,r)=>{let n=0,a=t.byteLength/17-1;for(;n<=a;){const s=a+n>>1,o=yt(e,i,r,t,17*s);if(o>0)n=s+1;else{if(!(o<0))return[pt(t,17*s+7),t.getUint32(17*s+13,!0)];a=s-1}}return null},xt=(t,e)=>t.is_dir&&!e.is_dir?1:!t.is_dir&&e.is_dir?-1:t.z!==e.z?t.z-e.z:t.x!==e.x?t.x-e.x:t.y-e.y,wt=(t,e)=>{const i=t.getUint8(17*e);return{z:127&i,x:ct(t,17*e+1),y:ct(t,17*e+4),offset:pt(t,17*e+7),length:t.getUint32(17*e+13,!0),is_dir:i>>7==1}},bt=t=>{const e=[],i=new DataView(t);for(let t=0;t<i.byteLength/17;t++)e.push(wt(i,t));return vt(e)},vt=t=>{t.sort(xt);const e=new ArrayBuffer(17*t.length),i=new Uint8Array(e);for(let e=0;e<t.length;e++){const r=t[e];let n=r.z;r.is_dir&&(n|=128),i[17*e]=n,i[17*e+1]=255&r.x,i[17*e+2]=r.x>>8&255,i[17*e+3]=r.x>>16&255,i[17*e+4]=255&r.y,i[17*e+5]=r.y>>8&255,i[17*e+6]=r.y>>16&255,i[17*e+7]=255&r.offset,i[17*e+8]=255&dt(r.offset,8),i[17*e+9]=255&dt(r.offset,16),i[17*e+10]=255&dt(r.offset,24),i[17*e+11]=255&dt(r.offset,32),i[17*e+12]=255&dt(r.offset,48),i[17*e+13]=255&r.length,i[17*e+14]=r.length>>8&255,i[17*e+15]=r.length>>16&255,i[17*e+16]=r.length>>24&255}return e},_t={getHeader:function(t){return D(this,null,(function*(){const e=yield t.getBytes(0,512e3),i=new DataView(e.data),r=i.getUint32(4,!0),n=i.getUint16(8,!0),a=new TextDecoder("utf-8"),s=JSON.parse(a.decode(new DataView(e.data,10,r)));let o=0;"gzip"===s.compression&&(o=2);let l=0;"minzoom"in s&&(l=+s.minzoom);let h=0;"maxzoom"in s&&(h=+s.maxzoom);let f=0,u=0,d=0,c=-180,p=-85,y=180,m=85;if(s.bounds){const t=s.bounds.split(",");c=+t[0],p=+t[1],y=+t[2],m=+t[3]}if(s.center){const t=s.center.split(",");f=+t[0],u=+t[1],d=+t[2]}return{specVersion:i.getUint16(2,!0),rootDirectoryOffset:10+r,rootDirectoryLength:17*n,jsonMetadataOffset:10,jsonMetadataLength:r,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:o,tileType:1,minZoom:l,maxZoom:h,minLon:c,minLat:p,maxLon:y,maxLat:m,centerZoom:d,centerLon:f,centerLat:u,etag:e.etag}}))},getZxy:function(t,e,i,r,n,a,s){return D(this,null,(function*(){let o=yield i.getArrayBuffer(e,t.rootDirectoryOffset,t.rootDirectoryLength,t);1===t.specVersion&&(o=bt(o));const l=mt(new DataView(o),r,n,a);if(l){let t=(yield e.getBytes(l.offset,l.length,s)).data;const i=new DataView(t);return 31==i.getUint8(0)&&139==i.getUint8(1)&&(t=ht(new Uint8Array(t))),{data:t}}const h=((t,e)=>{if(t.byteLength<17)return null;const i=t.byteLength/17,r=wt(t,i-1);if(r.is_dir){const t=r.z,i=e.z-t;return{z:t,x:Math.trunc(e.x/(1<<i)),y:Math.trunc(e.y/(1<<i))}}return null})(new DataView(o),{z:r,x:n,y:a});if(h){const l=((t,e,i,r)=>{const n=gt(t,128|e,i,r);return n?{z:e,x:i,y:r,offset:n[0],length:n[1],is_dir:!0}:null})(new DataView(o),h.z,h.x,h.y);if(l){let o=yield i.getArrayBuffer(e,l.offset,l.length,t);1===t.specVersion&&(o=bt(o));const h=mt(new DataView(o),r,n,a);if(h){let t=(yield e.getBytes(h.offset,h.length,s)).data;const i=new DataView(t);return 31==i.getUint8(0)&&139==i.getUint8(1)&&(t=ht(new Uint8Array(t))),{data:t}}}}}))}};function zt(t,e){return 4294967296*(e>>>0)+(t>>>0)}function kt(t){const e=t.buf;let i,r;return r=e[t.pos++],i=127&r,r<128?i:(r=e[t.pos++],i|=(127&r)<<7,r<128?i:(r=e[t.pos++],i|=(127&r)<<14,r<128?i:(r=e[t.pos++],i|=(127&r)<<21,r<128?i:(r=e[t.pos],i|=(15&r)<<28,function(t,e){const i=e.buf;let r,n;if(n=i[e.pos++],r=(112&n)>>4,n<128)return zt(t,r);if(n=i[e.pos++],r|=(127&n)<<3,n<128)return zt(t,r);if(n=i[e.pos++],r|=(127&n)<<10,n<128)return zt(t,r);if(n=i[e.pos++],r|=(127&n)<<17,n<128)return zt(t,r);if(n=i[e.pos++],r|=(127&n)<<24,n<128)return zt(t,r);if(n=i[e.pos++],r|=(1&n)<<31,n<128)return zt(t,r);throw new Error("Expected varint not more than 10 bytes")}(i,t)))))}function Mt(t,e,i,r){if(0==r){1==i&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);const r=e[0];e[0]=e[1],e[1]=r}}function Lt(t,e){return D(this,null,(function*(){if(1===e||0===e)return t;if(2===e)return ht(new Uint8Array(t));throw Error("Compression method not supported")}))}function Ft(t,e){let i=0,r=t.length-1;for(;i<=r;){const n=r+i>>1,a=e-t[n].tileId;if(a>0)i=n+1;else{if(!(a<0))return t[n];r=n-1}}if(r>=0){if(0===t[r].runLength)return t[r];if(e-t[r].tileId<t[r].runLength)return t[r]}return null}var St=class{constructor(t){this.url=t}getKey(){return this.url}getBytes(t,e,i){return D(this,null,(function*(){let r;i||(r=new AbortController,i=r.signal);let n=yield fetch(this.url,{signal:i,headers:{Range:"bytes="+t+"-"+(t+e-1)}});if(416===n.status&&0===t){const t=n.headers.get("Content-Range");if(!t||!t.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const e=+t.substr(8);n=yield fetch(this.url,{signal:i,headers:{Range:"bytes=0-"+(e-1)}})}if(n.status>=300)throw Error("Bad response code: "+n.status);const a=n.headers.get("Content-Length");if(200===n.status&&(!a||+a>e))throw r&&r.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield n.arrayBuffer(),etag:n.headers.get("ETag")||void 0,cacheControl:n.headers.get("Cache-Control")||void 0,expires:n.headers.get("Expires")||void 0}}))}};function Ct(t,e){const i=t.getUint32(e+4,!0),r=t.getUint32(e+0,!0);return i*Math.pow(2,32)+r}function Tt(t){const e={buf:new Uint8Array(t),pos:0},i=kt(e),r=[];let n=0;for(let t=0;t<i;t++){const t=kt(e);r.push({tileId:n+t,offset:0,length:0,runLength:1}),n+=t}for(let t=0;t<i;t++)r[t].runLength=kt(e);for(let t=0;t<i;t++)r[t].length=kt(e);for(let t=0;t<i;t++){const i=kt(e);r[t].offset=0===i&&t>0?r[t-1].offset+r[t-1].length:i-1}return r}var Bt=class extends Error{};var Dt,Yt,Xt=class{constructor(t=100,e=!0,i=Lt){this.cache=new Map,this.maxCacheEntries=t,this.counter=1,this.prefetch=e,this.decompress=i}getHeader(t,e){return D(this,null,(function*(){const i=t.getKey();if(this.cache.has(i))return this.cache.get(i).lastUsed=this.counter++,yield this.cache.get(i).data;const r=new Promise(((i,r)=>{(function(t,e,i,r){return D(this,null,(function*(){const n=yield t.getBytes(0,16384);if(19792!==new DataView(n.data).getUint16(0,!0))throw new Error("Wrong magic number for PMTiles archive");if(function(t){const e=new DataView(t);return 2===e.getUint16(2,!0)?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):1===e.getUint16(2,!0)?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}(n.data)<3)return[yield _t.getHeader(t)];const a=n.data.slice(0,127);let s=n.etag;r&&n.etag!=r&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+t.getKey()),s=void 0);const o=function(t,e){const i=new DataView(t),r=i.getUint8(7);if(r>3)throw Error(`Archive is spec version ${r} but this library supports up to spec version 3`);return{specVersion:r,rootDirectoryOffset:Ct(i,8),rootDirectoryLength:Ct(i,16),jsonMetadataOffset:Ct(i,24),jsonMetadataLength:Ct(i,32),leafDirectoryOffset:Ct(i,40),leafDirectoryLength:Ct(i,48),tileDataOffset:Ct(i,56),tileDataLength:Ct(i,64),numAddressedTiles:Ct(i,72),numTileEntries:Ct(i,80),numTileContents:Ct(i,88),clustered:1===i.getUint8(96),internalCompression:i.getUint8(97),tileCompression:i.getUint8(98),tileType:i.getUint8(99),minZoom:i.getUint8(100),maxZoom:i.getUint8(101),minLon:i.getInt32(102,!0)/1e7,minLat:i.getInt32(106,!0)/1e7,maxLon:i.getInt32(110,!0)/1e7,maxLat:i.getInt32(114,!0)/1e7,centerZoom:i.getUint8(118),centerLon:i.getInt32(119,!0)/1e7,centerLat:i.getInt32(123,!0)/1e7,etag:e}}(a,s);if(i){const i=n.data.slice(o.rootDirectoryOffset,o.rootDirectoryOffset+o.rootDirectoryLength),r=t.getKey()+"|"+(o.etag||"")+"|"+o.rootDirectoryOffset+"|"+o.rootDirectoryLength,a=Tt(yield e(i,o.internalCompression));return[o,[r,a.length,a]]}return[o,void 0]}))})(t,this.decompress,this.prefetch,e).then((t=>{t[1]&&this.cache.set(t[1][0],{lastUsed:this.counter++,data:Promise.resolve(t[1][2])}),i(t[0]),this.prune()})).catch((t=>{r(t)}))}));return this.cache.set(i,{lastUsed:this.counter++,data:r}),r}))}getDirectory(t,e,i,r){return D(this,null,(function*(){const n=t.getKey()+"|"+(r.etag||"")+"|"+e+"|"+i;if(this.cache.has(n))return this.cache.get(n).lastUsed=this.counter++,yield this.cache.get(n).data;const a=new Promise(((n,a)=>{(function(t,e,i,r,n){return D(this,null,(function*(){const a=yield t.getBytes(i,r);if(n.etag&&n.etag!==a.etag)throw new Bt(a.etag);const s=Tt(yield e(a.data,n.internalCompression));if(0===s.length)throw new Error("Empty directory is invalid");return s}))})(t,this.decompress,e,i,r).then((t=>{n(t),this.prune()})).catch((t=>{a(t)}))}));return this.cache.set(n,{lastUsed:this.counter++,data:a}),a}))}getArrayBuffer(t,e,i,r){return D(this,null,(function*(){const n=t.getKey()+"|"+(r.etag||"")+"|"+e+"|"+i;if(this.cache.has(n))return this.cache.get(n).lastUsed=this.counter++,yield this.cache.get(n).data;const a=new Promise(((a,s)=>{t.getBytes(e,i).then((t=>{if(r.etag&&r.etag!==t.etag)throw new Bt(t.etag);a(t.data),this.cache.has(n),this.prune()})).catch((t=>{s(t)}))}));return this.cache.set(n,{lastUsed:this.counter++,data:a}),a}))}prune(){if(this.cache.size>=this.maxCacheEntries){let t,e=1/0;this.cache.forEach(((i,r)=>{i.lastUsed<e&&(e=i.lastUsed,t=r)})),t&&this.cache.delete(t)}}invalidate(t,e){return D(this,null,(function*(){this.cache.delete(t.getKey()),yield this.getHeader(t,e)}))}},Pt=class{constructor(t,e,i){this.source="string"==typeof t?new St(t):t,this.decompress=i||Lt,this.cache=e||new Xt}getHeader(){return D(this,null,(function*(){return yield this.cache.getHeader(this.source)}))}getZxyAttempt(t,e,i,r){return D(this,null,(function*(){const n=function(t,e,i){if(t>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>Math.pow(2,t)-1||i>Math.pow(2,t)-1)throw Error("tile x/y outside zoom level bounds");let r=0,n=0;for(;n<t;)r+=Math.pow(2,n)*Math.pow(2,n),n++;let a=0,s=0,o=0;const l=[e,i];let h=Math.pow(2,t)/2;for(;h>0;)a=(l[0]&h)>0?1:0,s=(l[1]&h)>0?1:0,o+=h*h*(3*a^s),Mt(h,l,a,s),h/=2;return r+o}(t,e,i),a=yield this.cache.getHeader(this.source);if(a.specVersion<3)return _t.getZxy(a,this.source,this.cache,t,e,i,r);if(t<a.minZoom||t>a.maxZoom)return;let s=a.rootDirectoryOffset,o=a.rootDirectoryLength;for(let t=0;t<=3;t++){const t=Ft(yield this.cache.getDirectory(this.source,s,o,a),n);if(!t)return;if(t.runLength>0){const e=yield this.source.getBytes(a.tileDataOffset+t.offset,t.length,r);if(a.etag&&a.etag!==e.etag)throw new Bt(e.etag);return{data:yield this.decompress(e.data,a.tileCompression),cacheControl:e.cacheControl,expires:e.expires}}s=a.leafDirectoryOffset+t.offset,o=t.length}throw Error("Maximum directory depth exceeded")}))}getZxy(t,e,i,r){return D(this,null,(function*(){try{return yield this.getZxyAttempt(t,e,i,r)}catch(n){if(n instanceof Bt)return this.cache.invalidate(this.source,n.message),yield this.getZxyAttempt(t,e,i,r);throw n}}))}getMetadataAttempt(){return D(this,null,(function*(){const t=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(t.jsonMetadataOffset,t.jsonMetadataLength);if(t.etag&&t.etag!==e.etag)throw new Bt(e.etag);const i=yield this.decompress(e.data,t.internalCompression),r=new TextDecoder("utf-8");return JSON.parse(r.decode(i))}))}getMetadata(){return D(this,null,(function*(){try{return yield this.getMetadataAttempt()}catch(t){if(t instanceof Bt)return this.cache.invalidate(this.source,t.message),yield this.getMetadataAttempt();throw t}}))}};function jt(t){return t.x+":"+t.y+":"+t.z}(Yt=Dt||(Dt={}))[Yt.Point=1]="Point",Yt[Yt.Line=2]="Line",Yt[Yt.Polygon=3]="Polygon";var Et=(t,e,i)=>{t.pos=e;for(var r=t.readVarint()+t.pos,n=1,a=0,s=0,o=0,l=1/0,h=-1/0,f=1/0,u=-1/0,d=[],c=[];t.pos<r;){if(a<=0){var p=t.readVarint();n=7&p,a=p>>3}if(a--,1===n||2===n)(s+=t.readSVarint()*i)<l&&(l=s),s>h&&(h=s),(o+=t.readSVarint()*i)<f&&(f=o),o>u&&(u=o),1===n&&(c.length>0&&d.push(c),c=[]),c.push(new C.default(s,o));else{if(7!==n)throw new Error("unknown command "+n);c&&c.push(c[0].clone())}}return c&&d.push(c),{geom:d,bbox:{minX:l,minY:f,maxX:h,maxY:u}}};function Vt(t,e){let i=new T.VectorTile(new B.default(t)),r=new Map;for(let[t,n]of Object.entries(i.layers)){let i=[],a=n;for(let t=0;t<a.length;t++){let r=Et(a.feature(t)._pbf,a.feature(t)._geometry,e/a.extent),n=0;for(let t of r.geom)n+=t.length;i.push({id:a.feature(t).id,geomType:a.feature(t).type,geom:r.geom,numVertices:n,bbox:r.bbox,props:a.feature(t).properties})}r.set(t,i)}return r}var It=class{constructor(t,e){this.p="string"==typeof t?new Pt(t):t,this.controllers=[],this.shouldCancelZooms=e}get(t,e){return p(this,null,(function*(){this.shouldCancelZooms&&(this.controllers=this.controllers.filter((e=>e[0]==t.z||(e[1].abort(),!1))));const i=new AbortController;this.controllers.push([t.z,i]);const r=i.signal;let n=yield this.p.getZxy(t.z,t.x,t.y,r);return n?Vt(n.data,e):new Map}))}},At=class{constructor(t,e){this.url=t,this.controllers=[],this.shouldCancelZooms=e}get(t,e){return p(this,null,(function*(){this.shouldCancelZooms&&(this.controllers=this.controllers.filter((e=>e[0]==t.z||(e[1].abort(),!1))));let i=this.url.replace("{z}",t.z.toString()).replace("{x}",t.x.toString()).replace("{y}",t.y.toString());const r=new AbortController;this.controllers.push([t.z,r]);const n=r.signal;return new Promise(((t,r)=>{fetch(i,{signal:n}).then((t=>t.arrayBuffer())).then((i=>{let r=Vt(i,e);t(r)})).catch((t=>{r(t)}))}))}))}},Ut=6378137,Rt=85.0511287798,Ot=Ut*Math.PI;function qt(t){return t*t}function $t(t,e){return qt(t.x-e.x)+qt(t.y-e.y)}function Wt(t,e,i){var r=$t(e,i);if(0===r)return $t(t,e);var n=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/r;return n=Math.max(0,Math.min(1,n)),$t(t,new C.default(e.x+n*(i.x-e.x),e.y+n*(i.y-e.y)))}function Nt(t,e){for(var i=!1,r=0,n=e.length-1;r<e.length;n=r++){var a=e[r].x,s=e[r].y,o=e[n].x,l=e[n].y;s>t.y!=l>t.y&&t.x<(o-a)*(t.y-s)/(l-s)+a&&(i=!i)}return i}function Zt(t){for(var e=0,i=0;i<t.length;i++){let r=(i+1)%t.length;e+=t[i].x*t[r].y,e-=t[r].x*t[i].y}return e<0}function Kt(t,e){var i=!1;for(let r of e)if(Zt(r))Nt(t,r)&&(i=!1);else{if(i)return!0;Nt(t,r)&&(i=!0)}return i}function Ht(t,e){let i=1/0;for(let r of e){let e=Math.sqrt($t(t,r[0]));e<i&&(i=e)}return i}function Jt(t,e){let i=1/0;for(let n of e)for(var r=0;r<n.length-1;r++){let e=Math.sqrt(Wt(t,n[r],n[r+1]));e<i&&(i=e)}return i}var Gt=class{constructor(t,e){this.source=t,this.cache=new Map,this.inflight=new Map,this.tileSize=e}queryFeatures(t,e,i,r){let n=(t=>{let e=Math.PI/180,i=Math.max(Math.min(Rt,t[0]),-Rt),r=Math.sin(i*e);return new C.default(Ut*t[1]*e,Ut*Math.log((1+r)/(1-r))/2)})([e,t]);var a=new C.default((n.x+Ot)/(2*Ot),1-(n.y+Ot)/(2*Ot));a.x>1&&(a.x=a.x-Math.floor(a.x));let s=a.mult(1<<i),o=Math.floor(s.x),l=Math.floor(s.y);const h=jt({z:i,x:o,y:l});let f=[],u=this.cache.get(h);if(u){const t=new C.default((s.x-o)*this.tileSize,(s.y-l)*this.tileSize);for(let[e,i]of u.data.entries())for(let n of i)1==n.geomType?Ht(t,n.geom)<r&&f.push({feature:n,layerName:e}):2==n.geomType?Jt(t,n.geom)<r&&f.push({feature:n,layerName:e}):Kt(t,n.geom)&&f.push({feature:n,layerName:e})}return f}get(t){return p(this,null,(function*(){const e=jt(t);return new Promise(((i,r)=>{let n=this.cache.get(e);if(n)n.used=performance.now(),i(n.data);else{let n=this.inflight.get(e);n?n.push([i,r]):(this.inflight.set(e,[]),this.source.get(t,this.tileSize).then((t=>{this.cache.set(e,{used:performance.now(),data:t});let r=this.inflight.get(e);if(r&&r.forEach((e=>e[0](t))),this.inflight.delete(e),i(t),this.cache.size>=64){let t,e=1/0;this.cache.forEach(((i,r)=>{i.used<e&&(e=i.used,t=r)})),t&&this.cache.delete(t)}})).catch((t=>{let i=this.inflight.get(e);i&&i.forEach((e=>e[1](t))),this.inflight.delete(e),r(t)})))}}))}))}},Qt=(t,e,i)=>{let r=[];for(let n of t){let t=[];for(let r of n)t.push(r.clone().mult(e).add(i));r.push(t)}return r},te=(t,e)=>{let i=1<<e;return t<0&&(t=i+t),t>=i&&(t%=i),t},ee=class{constructor(t,e,i){this.tileCache=t,this.maxDataLevel=e,this.levelDiff=i}dataTilesForBounds(t,e){let i=Math.pow(2,t)/Math.pow(2,Math.ceil(t)),r=[];var n=1,a=this.tileCache.tileSize;if(t<this.levelDiff)n=1/(1<<this.levelDiff-t)*i,r.push({data_tile:{z:0,x:0,y:0},origin:new S.default(0,0),scale:n,dim:a*n});else if(t<=this.levelDiff+this.maxDataLevel){let n=1<<this.levelDiff,l=256*i,h=Math.ceil(t)-this.levelDiff,f=Math.floor(e.minX/n/l),u=Math.floor(e.minY/n/l),d=Math.floor(e.maxX/n/l),c=Math.floor(e.maxY/n/l);for(var s=f;s<=d;s++)for(var o=u;o<=c;o++){let t=new S.default(s*n*l,o*n*l);r.push({data_tile:{z:h,x:te(s,h),y:te(o,h)},origin:t,scale:i,dim:a*i})}}else{let l=1<<this.levelDiff;n=(1<<Math.ceil(t)-this.maxDataLevel-this.levelDiff)*i;let h=Math.floor(e.minX/l/256/n),f=Math.floor(e.minY/l/256/n),u=Math.floor(e.maxX/l/256/n),d=Math.floor(e.maxY/l/256/n);for(s=h;s<=u;s++)for(o=f;o<=d;o++){let t=new S.default(s*l*256*n,o*l*256*n);r.push({data_tile:{z:this.maxDataLevel,x:te(s,this.maxDataLevel),y:te(o,this.maxDataLevel)},origin:t,scale:n,dim:a*n})}}return r}dataTileForDisplayTile(t){var e,i,r=1,n=this.tileCache.tileSize;if(t.z<this.levelDiff)e={z:0,x:0,y:0},r=1/(1<<this.levelDiff-t.z),i=new S.default(0,0),n*=r;else if(t.z<=this.levelDiff+this.maxDataLevel){let r=1<<this.levelDiff;e={z:t.z-this.levelDiff,x:Math.floor(t.x/r),y:Math.floor(t.y/r)},i=new S.default(e.x*r*256,e.y*r*256)}else{r=1<<t.z-this.maxDataLevel-this.levelDiff;let a=1<<this.levelDiff;e={z:this.maxDataLevel,x:Math.floor(t.x/a/r),y:Math.floor(t.y/a/r)},i=new S.default(e.x*a*r*256,e.y*a*r*256),n*=r}return{data_tile:e,scale:r,origin:i,dim:n}}getBbox(t,e){return p(this,null,(function*(){let i=this.dataTilesForBounds(t,e);return(yield Promise.all(i.map((t=>this.tileCache.get(t.data_tile))))).map(((e,r)=>{let n=i[r];return{data:e,z:t,data_tile:n.data_tile,scale:n.scale,dim:n.dim,origin:n.origin}}))}))}getDisplayTile(t){return p(this,null,(function*(){let e=this.dataTileForDisplayTile(t);return{data:yield this.tileCache.get(e.data_tile),z:t.z,data_tile:e.data_tile,scale:e.scale,origin:e.origin,dim:e.dim}}))}queryFeatures(t,e,i){let r=Math.round(i),n=Math.min(r-this.levelDiff,this.maxDataLevel),a=16/(1<<r-n);return this.tileCache.queryFeatures(t,e,n,a)}},ie=t=>{let e=t=>{let e,i=void 0===t.levelDiff?2:t.levelDiff,r=t.maxDataZoom||14;e="string"==typeof t.url?t.url.endsWith(".pmtiles")?new It(t.url,!0):new At(t.url,!0):new It(t.url,!0);let n=new Gt(e,256<<i);return new ee(n,r,i)},i=new Map;if(t.sources)for(const r in t.sources)i.set(r,e(t.sources[r]));else i.set("",e(t));return i},re=c(y());function ne(t,e,i,r,n,a,s,o,l){let h=performance.now();for(var f of(t.save(),t.miterLimit=2,n)){if(f.minzoom&&e<f.minzoom)continue;if(f.maxzoom&&e>f.maxzoom)continue;let r=i.get(f.dataSource||"");if(r)for(let e of r){var u=e.data.get(f.dataLayer);if(void 0===u)continue;f.symbolizer.before&&f.symbolizer.before(t,e.z);let i=e.origin,r=e.dim,n=e.scale;if(t.save(),o){t.beginPath();let e=Math.max(i.x-s.x,a.minX-s.x),n=Math.max(i.y-s.y,a.minY-s.y),o=Math.min(i.x-s.x+r,a.maxX-s.x),l=Math.min(i.y-s.y+r,a.maxY-s.y);t.rect(e,n,o-e,l-n),t.clip()}for(var d of(t.translate(i.x-s.x,i.y-s.y),u)){let r=d.geom,s=d.bbox;s.maxX*n+i.x<a.minX||s.minX*n+i.x>a.maxX||s.minY*n+i.y>a.maxY||s.maxY*n+i.y<a.minY||f.filter&&!f.filter(e.z,d)||(1!=n&&(r=Qt(r,n,new re.default(0,0))),f.symbolizer.draw(t,r,e.z,d))}t.restore()}}if(o&&(t.beginPath(),t.rect(a.minX-s.x,a.minY-s.y,a.maxX-a.minX,a.maxY-a.minY),t.clip()),r){let e=r.searchBbox(a,1/0);for(var c of e)if(t.save(),t.translate(c.anchor.x-s.x,c.anchor.y-s.y),c.draw(t),t.restore(),l){t.lineWidth=.5,t.strokeStyle=l,t.fillStyle=l,t.globalAlpha=1,t.fillRect(c.anchor.x-s.x-2,c.anchor.y-s.y-2,4,4);for(let e of c.bboxes)t.strokeRect(e.minX-s.x,e.minY-s.y,e.maxX-e.minX,e.maxY-e.minY)}}return t.restore(),performance.now()-h}var ae=c(y()),se=c(_()),oe=(t,e,i)=>{let r=256,n=e/r,a=Math.floor(i.minX/r),s=Math.floor(i.minY/r),o=Math.floor(i.maxX/r),l=Math.floor(i.maxY/r),h=Math.log2(n),f=[];for(let e=a;e<=o;e++){let i=e%(1<<t);for(let e=s;e<=l;e++)f.push({display:jt({z:t,x:i,y:e}),key:jt({z:t-h,x:Math.floor(i/n),y:Math.floor(e/n)})})}return f},le=class{constructor(t,e){this.tree=new se.default,this.current=new Map,this.dim=t,this.maxLabeledTiles=e}hasPrefix(t){for(let e of this.current.keys())if(e.startsWith(t))return!0;return!1}has(t){return this.current.has(t)}size(){return this.current.size}keys(){return this.current.keys()}searchBbox(t,e){let i=new Set;for(let r of this.tree.search(t))r.indexed_label.order<=e&&i.add(r.indexed_label);return i}searchLabel(t,e){let i=new Set;for(let r of t.bboxes)for(let t of this.tree.search(r))t.indexed_label.order<=e&&i.add(t.indexed_label);return i}bboxCollides(t,e){for(let i of this.tree.search(t))if(i.indexed_label.order<=e)return!0;return!1}labelCollides(t,e){for(let i of t.bboxes)for(let t of this.tree.search(i))if(t.indexed_label.order<=e)return!0;return!1}deduplicationCollides(t){if(!t.deduplicationKey||!t.deduplicationDistance)return!1;let e=t.deduplicationDistance,i={minX:t.anchor.x-e,minY:t.anchor.y-e,maxX:t.anchor.x+e,maxY:t.anchor.y+e};for(let r of this.tree.search(i))if(r.indexed_label.deduplicationKey===t.deduplicationKey&&r.indexed_label.anchor.dist(t.anchor)<e)return!0;return!1}makeEntry(t){this.current.get(t)&&console.log("consistency error 1");let e=new Set;this.current.set(t,e)}insert(t,e,i){let r={anchor:t.anchor,bboxes:t.bboxes,draw:t.draw,order:e,tileKey:i,deduplicationKey:t.deduplicationKey,deduplicationDistance:t.deduplicationDistance},n=this.current.get(i);if(!n){let t=new Set;this.current.set(i,t),n=t}n.add(r);var a=!1,s=!1;for(let e of t.bboxes)(h=e).indexed_label=r,this.tree.insert(h),e.minX<0&&(a=!0),e.maxX>this.dim&&(s=!0);if(a||s){var o=a?this.dim:-this.dim,l=[];for(let e of t.bboxes)l.push({minX:e.minX+o,minY:e.minY,maxX:e.maxX+o,maxY:e.maxY});let r={anchor:new ae.default(t.anchor.x+o,t.anchor.y),bboxes:l,draw:t.draw,order:e,tileKey:i},n=this.current.get(i);n&&n.add(r);for(let t of l){var h;(h=t).indexed_label=r,this.tree.insert(h)}}}pruneOrNoop(t){let e,i=t.split(":"),r=0,n=0;for(var a of this.current.keys()){let t=a.split(":");if(t[3]===i[3]){n++;let s=Math.sqrt(Math.pow(+t[0]-+i[0],2)+Math.pow(+t[1]-+i[1],2));s>r&&(r=s,e=a)}e&&n>this.maxLabeledTiles&&this.pruneKey(e)}}pruneKey(t){let e=this.current.get(t);if(!e)return;let i=[];for(let t of this.tree.all())e.has(t.indexed_label)&&i.push(t);i.forEach((t=>{this.tree.remove(t)})),this.current.delete(t)}removeLabel(t){let e=[];for(let i of this.tree.all())t==i.indexed_label&&e.push(i);e.forEach((t=>{this.tree.remove(t)}));let i=this.current.get(t.tileKey);i&&i.delete(t)}},he=class{constructor(t,e,i,r,n){this.index=new le(256<<t,r),this.z=t,this.scratch=e,this.labelRules=i,this.callback=n}layout(t){let e=performance.now(),i=new Set;for(let[e,r]of t)for(let t of r){let r=jt(t.data_tile)+":"+e;this.index.has(r)||(this.index.makeEntry(r),i.add(r))}let r=new Set;for(let[e,a]of this.labelRules.entries()){if(0==a.visible)continue;if(a.minzoom&&this.z<a.minzoom)continue;if(a.maxzoom&&this.z>a.maxzoom)continue;let s=a.dataSource||"",o=t.get(s);if(o)for(let t of o){let o=jt(t.data_tile)+":"+s;if(!i.has(o))continue;let l=t.data.get(a.dataLayer);if(void 0===l)continue;let h=l;a.sort&&h.sort(((t,e)=>a.sort?a.sort(t.props,e.props):0));let f={index:this.index,zoom:this.z,scratch:this.scratch,order:e,overzoom:this.z-t.data_tile.z};for(let i of h){if(a.filter&&!a.filter(this.z,i))continue;let s=Qt(i.geom,t.scale,t.origin),l=a.symbolizer.place(f,s,i);if(l)for(let i of l){var n=!1;if(!i.deduplicationKey||!this.index.deduplicationCollides(i)){if(this.index.labelCollides(i,1/0)){if(!this.index.labelCollides(i,e)){let a=this.index.searchLabel(i,1/0);for(let e of a){this.index.removeLabel(e);for(let i of e.bboxes)this.findInvalidatedTiles(r,t.dim,i,o)}this.index.insert(i,e,o),n=!0}}else this.index.insert(i,e,o),n=!0;if(n)for(let e of i.bboxes)(e.maxX>t.origin.x+t.dim||e.minX<t.origin.x||e.minY<t.origin.y||e.maxY>t.origin.y+t.dim)&&this.findInvalidatedTiles(r,t.dim,e,o)}}}}}for(var a of i)this.index.pruneOrNoop(a);return r.size>0&&this.callback&&this.callback(r),performance.now()-e}findInvalidatedTiles(t,e,i,r){let n=oe(this.z,e,i);for(let e of n)e.key!=r&&this.index.hasPrefix(e.key)&&t.add(e.display)}add(t){var e=!0;for(let[i,r]of t)for(let t of r)this.index.has(jt(t.data_tile)+":"+i)||(e=!1);return e?0:this.layout(t)}},fe=class{constructor(t,e,i,r){this.labelers=new Map,this.scratch=t,this.labelRules=e,this.maxLabeledTiles=i,this.callback=r}add(t,e){var i=this.labelers.get(t);return i||(i=new he(t,this.scratch,this.labelRules,this.maxLabeledTiles,this.callback),this.labelers.set(t,i)),i.add(e)}getIndex(t){let e=this.labelers.get(t);if(e)return e.index}},ue={earth:"#FFFBF6",glacier:"#ffffff",residential:"#F4F4F8",hospital:"#FFF6F6",cemetery:"#EFF2EE",school:"#F7F6FF",industrial:"#FFF9EF",wood:"#F4F9EF",grass:"#EBF9E3",park:"#E5F9D5",water:"#B7DFF2",sand:"#ebebeb",buildings:"#F2EDE8",highwayCasing:"#FFC3C3",majorRoadCasing:"#FFB9B9",mediumRoadCasing:"#FFCE8E",minorRoadCasing:"#cccccc",highway:"#FFCEBB",majorRoad:"#FFE4B3",mediumRoad:"#FFF2C8",minorRoad:"#ffffff",boundaries:"#9e9e9e",mask:"#dddddd",countryLabel:"#aaaaaa",cityLabel:"#6C6C6C",stateLabel:"#999999",neighbourhoodLabel:"#888888",landuseLabel:"#898989",waterLabel:"#41ABDC",naturalLabel:"#4B8F14",roadsLabel:"#888888",poisLabel:"#606060"},de={earth:"#151515",glacier:"#1c1c1c",residential:"#252B2F",hospital:"#3E2C2C",cemetery:"#36483D",school:"#2C3440",industrial:"#33312C",wood:"#3A3E38",grass:"#4E604D",park:"#2C4034",water:"#4D5B73",sand:"#777777",buildings:"#464545",highwayCasing:"#000000",majorRoadCasing:"#1C1B1B",mediumRoadCasing:"#3E3E3E",minorRoadCasing:"#000000",highway:"#5B5B5B",majorRoad:"#595959",mediumRoad:"#4F4F4F",minorRoad:"#393939",boundaries:"#666666",mask:"#dddddd",countryLabel:"#ffffff",cityLabel:"#FFFFFF",stateLabel:"#ffffff",neighbourhoodLabel:"#FDFDFD",landuseLabel:"#DDDDDD",waterLabel:"#707E95",naturalLabel:"#4c4c4c",roadsLabel:"#C4C4C4",poisLabel:"#959393"};function ce(t,e,i){return Math.min(Math.max(t,i),e)}var pe=class extends Error{constructor(t){super(`Failed to parse color: "${t}"`)}},ye=t=>parseInt(t.replace(/_/g,""),36),me="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce(((t,e)=>{const i=ye(e.substring(0,3)),r=ye(e.substring(3)).toString(16);let n="";for(let t=0;t<6-r.length;t++)n+="0";return t[i]=`${n}${r}`,t}),{}),ge=(t,e)=>Array.from(Array(e)).map((()=>t)).join(""),xe=new RegExp(`^#${ge("([a-f0-9])",3)}([a-f0-9])?$`,"i"),we=new RegExp(`^#${ge("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),be=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${ge(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),ve=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,_e=/^[a-z]+$/i,ze=t=>Math.round(255*t),ke=(t,e,i)=>{let r=i/100;if(0===e)return[r,r,r].map(ze);const n=(t%360+360)%360/60,a=(1-Math.abs(2*r-1))*(e/100),s=a*(1-Math.abs(n%2-1));let o=0,l=0,h=0;n>=0&&n<1?(o=a,l=s):n>=1&&n<2?(o=s,l=a):n>=2&&n<3?(l=a,h=s):n>=3&&n<4?(l=s,h=a):n>=4&&n<5?(o=s,h=a):n>=5&&n<6&&(o=a,h=s);const f=r-a/2;return[o+f,l+f,h+f].map(ze)};function Me(t){const[e,i,r,n]=function(t){if("string"!=typeof t)throw new pe(t);if("transparent"===t.trim().toLowerCase())return[0,0,0,0];let e=t.trim();e=_e.test(t)?function(t){const e=t.toLowerCase().trim(),i=me[function(t){let e=5381,i=t.length;for(;i;)e=33*e^t.charCodeAt(--i);return(e>>>0)%2341}(e)];if(!i)throw new pe(t);return`#${i}`}(t):t;const i=xe.exec(e);if(i){const t=Array.from(i).slice(1);return[...t.slice(0,3).map((t=>parseInt(ge(t,2),16))),parseInt(ge(t[3]||"f",2),16)/255]}const r=we.exec(e);if(r){const t=Array.from(r).slice(1);return[...t.slice(0,3).map((t=>parseInt(t,16))),parseInt(t[3]||"ff",16)/255]}const n=be.exec(e);if(n){const t=Array.from(n).slice(1);return[...t.slice(0,3).map((t=>parseInt(t,10))),parseFloat(t[3]||"1")]}const a=ve.exec(e);if(a){const[e,i,r,n]=Array.from(a).slice(1).map(parseFloat);if(ce(0,100,i)!==i)throw new pe(t);if(ce(0,100,r)!==r)throw new pe(t);return[...ke(e,i,r),n||1]}throw new pe(t)}(t).map(((t,e)=>3===e?t:t/255)),a=Math.max(e,i,r),s=Math.min(e,i,r),o=(a+s)/2;if(a===s)return[0,0,o,n];const l=a-s;return[60*(e===a?(i-r)/l+(i<r?6:0):i===a?(r-e)/l+2:(e-i)/l+4),o>.5?l/(2-a-s):l/(a+s),o,n]}function Le(t,e,i,r){return`hsla(${(t%360).toFixed()}, ${ce(0,100,100*e).toFixed()}%, ${ce(0,100,100*i).toFixed()}%, ${parseFloat(ce(0,1,r).toFixed(3))})`}var Fe,Se,Ce,Te,Be=c(y()),De=c(z()),Ye=c(M()),Xe=class{constructor(t,e){this.str=null!=t?t:e,this.per_feature="function"==typeof this.str&&2==this.str.length}get(t,e){return"function"==typeof this.str?this.str(t,e):this.str}},Pe=class{constructor(t,e=1){this.value=null!=t?t:e,this.per_feature="function"==typeof this.value&&2==this.value.length}get(t,e){return"function"==typeof this.value?this.value(t,e):this.value}},je=class{constructor(t){var e;this.label_props=null!=(e=null==t?void 0:t.label_props)?e:["name"],this.textTransform=null==t?void 0:t.textTransform}get(t,e){let i,r,n;r="function"==typeof this.label_props?this.label_props(t,e):this.label_props;for(let t of r)if(e.props.hasOwnProperty(t)&&"string"==typeof e.props[t]){i=e.props[t];break}if(n="function"==typeof this.textTransform?this.textTransform(t,e):this.textTransform,i&&"uppercase"===n)i=i.toUpperCase();else if(i&&"lowercase"===n)i=i.toLowerCase();else if(i&&"capitalize"===n){const t=i.toLowerCase().split(" ");i=t.map((t=>t[0].toUpperCase()+t.slice(1))).join(" ")}return i}},Ee=class{constructor(t){var e,i;(null==t?void 0:t.font)?this.font=t.font:(this.family=null!=(e=null==t?void 0:t.fontFamily)?e:"sans-serif",this.size=null!=(i=null==t?void 0:t.fontSize)?i:12,this.weight=null==t?void 0:t.fontWeight,this.style=null==t?void 0:t.fontStyle)}get(t,e){if(this.font)return"function"==typeof this.font?this.font(t,e):this.font;var i="";this.style&&(i="function"==typeof this.style?this.style(t,e)+" ":this.style+" ");var r="";return this.weight&&(r="function"==typeof this.weight?this.weight(t,e)+" ":this.weight+" "),`${i}${r}${"function"==typeof this.size?this.size(t,e):this.size}px ${"function"==typeof this.family?this.family(t,e):this.family}`}},Ve=class{constructor(t,e=[]){this.value=null!=t?t:e,this.per_feature="function"==typeof this.value&&2==this.value.length}get(t,e){return"function"==typeof this.value?this.value(t,e):this.value}},Ie=c(y()),Ae=(t,e,i)=>{var r,n,a,s,o=[],l=0,h=0,f=0,u=0,d=0,c=0,p=0,y=0,m=0,g=0;if(t.length<2)return[];if(2===t.length)return[{length:h=Math.sqrt(Math.pow(t[1].x-t[0].x,2)+Math.pow(t[1].y-t[0].y,2)),beginIndex:0,beginDistance:0,endIndex:2,endDistance:h}];for(f=Math.sqrt(Math.pow(t[1].x-t[0].x,2)+Math.pow(t[1].y-t[0].y,2)),l=1,s=t.length-1;l<s;l++)r=t[l-1],n=t[l],a=t[l+1],d=n.x-r.x,c=n.y-r.y,p=a.x-n.x,y=a.y-n.y,u=Math.sqrt(p*p+y*y),h+=f,(Math.acos((d*p+c*y)/(f*u))>e||h-g>i)&&(o.push({length:h-g,beginDistance:g,beginIndex:m,endIndex:l+1,endDistance:h}),m=l,g=h),f=u;return l-m>0&&o.push({length:h-g+u,beginIndex:m,beginDistance:g,endIndex:l+1,endDistance:h+u}),o};function Ue(t,e,i,r){let n=e.x-t.x,a=e.y-t.y,s=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),o=[];for(var l=0;l<i+r;l+=2*r){let e=1*l/s;o.push({x:t.x+e*n,y:t.y+e*a})}return o}function Re(t,e){if(t.length<=e)return[t];let i,r,n=e-1,a=t.lastIndexOf(" ",n),s=t.indexOf(" ",n);return-1==a&&-1==s?[t]:(-1==s||a>=0&&n-a<s-n?(i=t.substring(0,a),r=t.substring(a+1,t.length)):(i=t.substring(0,s),r=t.substring(s+1,t.length)),[i,...Re(r,e)])}new RegExp("^[-------------]+$"),(Se=Fe||(Fe={}))[Se.Left=1]="Left",Se[Se.Center=2]="Center",Se[Se.Right=3]="Right",(Te=Ce||(Ce={}))[Te.N=1]="N",Te[Te.NE=2]="NE",Te[Te.E=3]="E",Te[Te.SE=4]="SE",Te[Te.S=5]="S",Te[Te.SW=6]="SW",Te[Te.W=7]="W",Te[Te.NW=8]="NW";var Oe=(t,e,i)=>{const r=document.createElement("canvas"),n=r.getContext("2d");return r.width=t,r.height=e,null!==n&&i(r,n),r},qe=class{constructor(t){var e;this.pattern=t.pattern,this.fill=new Xe(t.fill,"black"),this.opacity=new Pe(t.opacity,1),this.stroke=new Xe(t.stroke,"black"),this.width=new Pe(t.width,0),this.per_feature=null!=(e=this.fill.per_feature||this.opacity.per_feature||this.stroke.per_feature||this.width.per_feature||t.per_feature)&&e,this.do_stroke=!1}before(t,e){if(!this.per_feature){t.globalAlpha=this.opacity.get(e),t.fillStyle=this.fill.get(e),t.strokeStyle=this.stroke.get(e);let i=this.width.get(e);i>0&&(this.do_stroke=!0),t.lineWidth=i}if(this.pattern){const e=t.createPattern(this.pattern,"repeat");e&&(t.fillStyle=e)}}draw(t,e,i,r){var n=!1;if(this.per_feature){t.globalAlpha=this.opacity.get(i,r),t.fillStyle=this.fill.get(i,r);var a=this.width.get(i,r);a&&(n=!0,t.strokeStyle=this.stroke.get(i,r),t.lineWidth=a)}let s=()=>{t.fill(),(n||this.do_stroke)&&t.stroke()};var o=0;for(var l of(t.beginPath(),e)){o+l.length>5400&&(s(),o=0,t.beginPath());for(var h=0;h<l.length;h++){let e=l[h];0==h?t.moveTo(e.x,e.y):t.lineTo(e.x,e.y)}o+=l.length}o>0&&s()}};function $e(t,e){return i=>{let r=i-t;return r>=0&&r<e.length?e[r]:0}}function We(t,e){let i=0;for(;e[i+1][0]<t;)i++;return i}function Ne(t,e,i){return t*(i-e)+e}function Ze(t,e,i,r){const n=r[e+1][0]-r[e][0],a=t-r[e][0];return 0===n?0:1===i?a/n:(Math.pow(i,a)-1)/(Math.pow(i,n)-1)}function Ke(t,e){return i=>{if(e.length<1)return 0;if(i<=e[0][0])return e[0][1];if(i>=e[e.length-1][0])return e[e.length-1][1];const r=We(i,e);return Ne(Ze(i,r,t,e),e[r][1],e[r+1][1])}}function He(t,e){return i=>{if(e.length<1)return 0;let r=t;for(let t=0;t<e.length;t++)i>=e[t][0]&&(r=e[t][1]);return r}}function Je(t){return Ke(1,t)}function Ge(t,e,i,r,n){return a=>{if(n.length<1)return 0;const s=new De.default(t,e,i,r),o=We(a,n);return Ne(s.solve(Ze(a,o,1,n)),n[o][1],n[o+1][1])}}var Qe,ti,ei=class{constructor(t){var e;this.color=new Xe(t.color,"black"),this.width=new Pe(t.width),this.opacity=new Pe(t.opacity),this.dash=t.dash?new Ve(t.dash):null,this.dashColor=new Xe(t.dashColor,"black"),this.dashWidth=new Pe(t.dashWidth,1),this.lineCap=new Xe(t.lineCap,"butt"),this.lineJoin=new Xe(t.lineJoin,"miter"),this.skip=!1,this.per_feature=!!((null==(e=this.dash)?void 0:e.per_feature)||this.color.per_feature||this.opacity.per_feature||this.width.per_feature||this.lineCap.per_feature||this.lineJoin.per_feature||t.per_feature)}before(t,e){this.per_feature||(t.strokeStyle=this.color.get(e),t.lineWidth=this.width.get(e),t.globalAlpha=this.opacity.get(e),t.lineCap=this.lineCap.get(e),t.lineJoin=this.lineJoin.get(e))}draw(t,e,i,r){if(this.skip)return;let n=()=>{this.per_feature&&(t.globalAlpha=this.opacity.get(i,r),t.lineCap=this.lineCap.get(i,r),t.lineJoin=this.lineJoin.get(i,r)),this.dash?(t.save(),this.per_feature?(t.lineWidth=this.dashWidth.get(i,r),t.strokeStyle=this.dashColor.get(i,r),t.setLineDash(this.dash.get(i,r))):t.setLineDash(this.dash.get(i)),t.stroke(),t.restore()):(t.save(),this.per_feature&&(t.lineWidth=this.width.get(i,r),t.strokeStyle=this.color.get(i,r)),t.stroke(),t.restore())};var a=0;for(var s of(t.beginPath(),e)){a+s.length>5400&&(n(),a=0,t.beginPath());for(var o=0;o<s.length;o++){let e=s[o];0==o?t.moveTo(e.x,e.y):t.lineTo(e.x,e.y)}a+=s.length}a>0&&n()}},ii=class{constructor(t){this.name=t.name,this.sheet=t.sheet,this.dpr=window.devicePixelRatio}place(t,e,i){e[0];let r=new Be.default(e[0][0].x,e[0][0].y),n=this.sheet.get(this.name),a=n.w/this.dpr,s=n.h/this.dpr;return[{anchor:r,bboxes:[{minX:r.x-a/2,minY:r.y-s/2,maxX:r.x+a/2,maxY:r.y+s/2}],draw:t=>{t.globalAlpha=1,t.drawImage(this.sheet.canvas,n.x,n.y,n.w,n.h,-n.w/2/this.dpr,-n.h/2/this.dpr,n.w/2,n.h/2)}}]}},ri=class{constructor(t){this.radius=new Pe(t.radius,3),this.fill=new Xe(t.fill,"black"),this.stroke=new Xe(t.stroke,"white"),this.width=new Pe(t.width,0),this.opacity=new Pe(t.opacity)}draw(t,e,i,r){t.globalAlpha=this.opacity.get(i,r);let n=this.radius.get(i,r),a=this.width.get(i,r);a>0&&(t.strokeStyle=this.stroke.get(i,r),t.lineWidth=a,t.beginPath(),t.arc(e[0][0].x,e[0][0].y,n+a/2,0,2*Math.PI),t.stroke()),t.fillStyle=this.fill.get(i,r),t.beginPath(),t.arc(e[0][0].x,e[0][0].y,n,0,2*Math.PI),t.fill()}place(t,e,i){e[0];let r=new Be.default(e[0][0].x,e[0][0].y),n=this.radius.get(t.zoom,i);return[{anchor:r,bboxes:[{minX:r.x-n,minY:r.y-n,maxX:r.x+n,maxY:r.y+n}],draw:e=>{this.draw(e,[[new Be.default(0,0)]],t.zoom,i)}}]}},ni=class{constructor(t){this.font=new Ee(t),this.text=new je(t),this.fill=new Xe(t.fill,"black"),this.background=new Xe(t.background,"white"),this.padding=new Pe(t.padding,0)}place(t,e,i){let r=this.text.get(t.zoom,i);if(!r)return;let n=this.font.get(t.zoom,i);t.scratch.font=n;let a=t.scratch.measureText(r),s=a.width,o=a.actualBoundingBoxAscent,l=a.actualBoundingBoxDescent,h=(e[0],new Be.default(e[0][0].x,e[0][0].y)),f=this.padding.get(t.zoom,i);return[{anchor:h,bboxes:[{minX:h.x-s/2-f,minY:h.y-o-f,maxX:h.x+s/2+f,maxY:h.y+l+f}],draw:e=>{e.globalAlpha=1,e.fillStyle=this.background.get(t.zoom,i),e.fillRect(-s/2-f,-o-f,s+2*f,o+l+2*f),e.fillStyle=this.fill.get(t.zoom,i),e.font=n,e.fillText(r,-s/2,0)}}]}},ai=class{constructor(t){this.list=t}place(t,e,i){var r=this.list[0].place(t,e,i);if(!r)return;var n=r[0];let a=n.anchor,s=n.bboxes[0],o=s.maxY-s.minY,l=[{draw:n.draw,translate:{x:0,y:0}}],h=[[new Be.default(e[0][0].x,e[0][0].y+o)]];for(let e=1;e<this.list.length;e++)(r=this.list[e].place(t,h,i))&&(n=r[0],s=si(s,n.bboxes[0]),l.push({draw:n.draw,translate:{x:0,y:o}}));return[{anchor:a,bboxes:[s],draw:t=>{for(let e of l)t.save(),t.translate(e.translate.x,e.translate.y),e.draw(t),t.restore()}}]}},si=(t,e)=>({minX:Math.min(t.minX,e.minX),minY:Math.min(t.minY,e.minY),maxX:Math.max(t.maxX,e.maxX),maxY:Math.max(t.maxY,e.maxY)}),oi=class{constructor(t){this.list=t}place(t,e,i){let r=this.list[0];if(!r)return;var n=r.place(t,e,i);if(!n)return;var a=n[0];let s=a.anchor,o=a.bboxes[0],l=[a.draw];for(let r=1;r<this.list.length;r++){if(!(n=this.list[r].place(t,e,i)))return;a=n[0],o=si(o,a.bboxes[0]),l.push(a.draw)}return[{anchor:s,bboxes:[o],draw:t=>{l.forEach((e=>e(t)))}}]}},li=class{constructor(t){this.symbolizer=t}place(t,e,i){let r=e[0][0],n=this.symbolizer.place(t,[[new Be.default(0,0)]],i);if(!n||0==n.length)return;let a=n[0],s=a.bboxes[0],o=s.maxX-s.minX,l=s.maxY-s.minY;return[{anchor:r,bboxes:[{minX:r.x-o/2,maxX:r.x+o/2,minY:r.y-l/2,maxY:r.y+l/2}],draw:t=>{t.translate(-o/2,l/2-s.maxY),a.draw(t,{justify:2})}}]}},hi=class{constructor(t,e){this.padding=new Pe(t,0),this.symbolizer=e}place(t,e,i){let r=this.symbolizer.place(t,e,i);if(!r||0==r.length)return;let n=this.padding.get(t.zoom,i);for(var a of r)for(var s of a.bboxes)s.minX-=n,s.minY-=n,s.maxX+=n,s.maxY+=n;return r}},fi=class{constructor(t){this.font=new Ee(t),this.text=new je(t),this.fill=new Xe(t.fill,"black"),this.stroke=new Xe(t.stroke,"black"),this.width=new Pe(t.width,0),this.lineHeight=new Pe(t.lineHeight,1),this.letterSpacing=new Pe(t.letterSpacing,0),this.maxLineCodeUnits=new Pe(t.maxLineChars,15),this.justify=t.justify}place(t,e,i){let r=this.text.get(t.zoom,i);if(!r)return;let n=this.font.get(t.zoom,i);t.scratch.font=n;let a=this.letterSpacing.get(t.zoom,i),s=Re(r,this.maxLineCodeUnits.get(t.zoom,i));var o="",l=0;for(let t of s)t.length>l&&(l=t.length,o=t);let h=t.scratch.measureText(o),f=h.width+a*(l-1),u=h.actualBoundingBoxAscent,d=h.actualBoundingBoxDescent,c=(u+d)*this.lineHeight.get(t.zoom,i),p=new Be.default(e[0][0].x,e[0][0].y);return[{anchor:p,bboxes:[{minX:p.x,minY:p.y-u,maxX:p.x+f,maxY:p.y+d+(s.length-1)*c}],draw:(e,r)=>{e.globalAlpha=1,e.font=n,e.fillStyle=this.fill.get(t.zoom,i);let o=this.width.get(t.zoom,i);var l=0;for(let n of s){var h=0;if(2==this.justify||r&&2==r.justify?h=(f-e.measureText(n).width)/2:(3==this.justify||r&&3==r.justify)&&(h=f-e.measureText(n).width),o)if(e.lineWidth=2*o,e.strokeStyle=this.stroke.get(t.zoom,i),a>0){var u=h;for(var d of n)e.strokeText(d,u,l),u+=e.measureText(d).width+a}else e.strokeText(n,h,l);if(a>0)for(var d of(u=h,n))e.fillText(d,u,l),u+=e.measureText(d).width+a;else e.fillText(n,h,l);l+=c}}}]}},ui=class{constructor(t){this.centered=new li(new fi(t))}place(t,e,i){return this.centered.place(t,e,i)}},di=class{constructor(t,e){var i,r,n;this.symbolizer=t,this.offsetX=new Pe(e.offsetX,0),this.offsetY=new Pe(e.offsetY,0),this.justify=null!=(i=e.justify)?i:void 0,this.placements=null!=(r=e.placements)?r:[2,6,8,4,1,3,5,7],this.ddValues=null!=(n=e.ddValues)?n:()=>({})}place(t,e,i){if(i.geomType!==Dt.Point)return;let r=e[0][0],n=this.symbolizer.place(t,[[new Be.default(0,0)]],i);if(!n||0==n.length)return;let a=n[0],s=a.bboxes[0],o=this.offsetX,l=this.offsetY,h=this.justify,f=this.placements;const{offsetX:u,offsetY:d,justify:c,placements:p}=this.ddValues(t.zoom,i)||{};u&&(o=new Pe(u,0)),d&&(l=new Pe(d,0)),c&&(h=c),p&&(f=p);const y=o.get(t.zoom,i),m=l.get(t.zoom,i);var g,x=new Be.default(y,m);let w=t=>{t.translate(x.x,x.y),a.draw(t,{justify:g})};const b=(e,i)=>{const n=((t,e)=>({minX:t.x+e.x+s.minX,minY:t.y+e.y+s.minY,maxX:t.x+e.x+s.maxX,maxY:t.y+e.y+s.maxY}))(e,i);if(!t.index.bboxCollides(n,t.order))return[{anchor:r,bboxes:[n],draw:w}]};for(let t of f){const e=this.computeXAxisOffset(y,s,t),i=this.computeYAxisOffset(m,s,t);return g=this.computeJustify(h,t),x=new Be.default(e,i),b(r,x)}}computeXAxisOffset(t,e,i){const r=e.maxX,n=r/2;return[1,5].includes(i)?t-n:[8,7,6].includes(i)?t-r:t}computeYAxisOffset(t,e,i){const r=Math.abs(e.minY),n=e.maxY,a=(e.minY+e.maxY)/2;return[3,7].includes(i)?t-a:[8,2,1].includes(i)?t-n:[6,4,5].includes(i)?t+r:t}computeJustify(t,e){return t||([1,5].includes(e)?2:[2,3,4].includes(e)?1:3)}},ci=class{constructor(t){this.symbolizer=new di(new fi(t),t)}place(t,e,i){return this.symbolizer.place(t,e,i)}};(ti=Qe||(Qe={}))[ti.Above=1]="Above",ti[ti.Center=2]="Center",ti[ti.Below=3]="Below";var pi=class{constructor(t){var e;this.font=new Ee(t),this.text=new je(t),this.fill=new Xe(t.fill,"black"),this.stroke=new Xe(t.stroke,"black"),this.width=new Pe(t.width,0),this.offset=new Pe(t.offset,0),this.position=null!=(e=t.position)?e:1,this.maxLabelCodeUnits=new Pe(t.maxLabelChars,40),this.repeatDistance=new Pe(t.repeatDistance,250)}place(t,e,i){let r=this.text.get(t.zoom,i);if(!r)return;if(r.length>this.maxLabelCodeUnits.get(t.zoom,i))return;let n=i.bbox;if(n.maxY-n.minY<20&&n.maxX-n.minX<20)return;let a=this.font.get(t.zoom,i);t.scratch.font=a;let s=t.scratch.measureText(r),o=s.width,l=s.actualBoundingBoxAscent+s.actualBoundingBoxDescent;var h=this.repeatDistance.get(t.zoom,i);t.overzoom>4&&(h*=1<<t.overzoom-4);let f=2*l,u=function(t,e,i,r){let n=[];for(let s of t){let t=Ae(s,Math.PI/45,e);for(let o of t)if(o.length>=e+r){let t=new Ie.default(s[o.beginIndex].x,s[o.beginIndex].y),l=s[o.endIndex-1],h=new Ie.default((l.x-t.x)/o.length,(l.y-t.y)/o.length);for(var a=r;a<o.length-e;a+=i)n.push({start:t.add(h.mult(a)),end:t.add(h.mult(a+e))})}}return n}(e,o,h,f);if(0==u.length)return;let d=[];for(let e of u){let n=e.end.x-e.start.x,s=e.end.y-e.start.y,u=Ue(e.start,e.end,o,f/2).map((t=>({minX:t.x-f/2,minY:t.y-f/2,maxX:t.x+f/2,maxY:t.y+f/2}))),c=e=>{e.globalAlpha=1,e.rotate(Math.atan2(s,n)),n<0&&(e.scale(-1,-1),e.translate(-o,0));let h=0;3===this.position?h+=l:2===this.position&&(h+=l/2),e.translate(0,h-this.offset.get(t.zoom,i)),e.font=a;let f=this.width.get(t.zoom,i);f&&(e.lineWidth=f,e.strokeStyle=this.stroke.get(t.zoom,i),e.strokeText(r,0,0)),e.fillStyle=this.fill.get(t.zoom,i),e.fillText(r,0,0)};d.push({anchor:e.start,bboxes:u,draw:c,deduplicationKey:r,deduplicationDistance:h})}return d}},yi=class{constructor(t){this.symbolizer=new fi(t)}place(t,e,i){let r=i.bbox;if((r.maxY-r.minY)*(r.maxX-r.minX)<2e4)return;let n=this.symbolizer.place(t,[[new Be.default(0,0)]],i);if(!n||0==n.length)return;let a=n[0],s=a.bboxes[0],o=e[0],l=(0,Ye.default)([o.map((t=>[t.x,t.y]))]),h=new Be.default(l[0],l[1]);return[{anchor:h,bboxes:[{minX:h.x-(s.maxX-s.minX)/2,minY:h.y-(s.maxY-s.minY)/2,maxX:h.x+(s.maxX-s.minX)/2,maxY:h.y+(s.maxY-s.minY)/2}],draw:t=>{t.translate(a.anchor.x-(s.maxX-s.minX)/2,a.anchor.y),a.draw(t)}}]}},mi=(t,e)=>{let i=Me(e),r=((t,e)=>{for(var i in e||(e={}))h.call(e,i)&&u(t,i,e[i]);if(o)for(var i of o(e))f.call(e,i)&&u(t,i,e[i]);return t})({},t);for(const[e,n]of Object.entries(t)){let t=Me(n);r[e]=Le(i[0],i[1],t[2],t[3])}return r},gi=(t,e)=>(e&&(t=mi(t,e)),[{dataLayer:"earth",symbolizer:new qe({fill:t.earth})},{dataLayer:"natural",symbolizer:new qe({fill:t.glacier}),filter:(t,e)=>"glacier"==e.props.natural},{dataLayer:"landuse",symbolizer:new qe({fill:t.residential}),filter:(t,e)=>"residential"==e.props.landuse||"neighbourhood"==e.props.place},{dataLayer:"landuse",symbolizer:new qe({fill:t.hospital}),filter:(t,e)=>"hospital"==e.props.amenity},{dataLayer:"landuse",symbolizer:new qe({fill:t.cemetery}),filter:(t,e)=>"cemetery"==e.props.landuse},{dataLayer:"landuse",symbolizer:new qe({fill:t.school}),filter:(t,e)=>"school"==e.props.amenity||"kindergarten"==e.props.amenity||"university"==e.props.amenity||"college"==e.props.amenity},{dataLayer:"landuse",symbolizer:new qe({fill:t.industrial}),filter:(t,e)=>"industrial"==e.props.landuse},{dataLayer:"natural",symbolizer:new qe({fill:t.wood}),filter:(t,e)=>"wood"==e.props.natural},{dataLayer:"landuse",symbolizer:new qe({fill:t.grass}),filter:(t,e)=>"grass"==e.props.landuse},{dataLayer:"landuse",symbolizer:new qe({fill:t.park}),filter:(t,e)=>"park"==e.props.leisure},{dataLayer:"water",symbolizer:new qe({fill:t.water})},{dataLayer:"natural",symbolizer:new qe({fill:t.sand}),filter:(t,e)=>"sand"==e.props.natural},{dataLayer:"buildings",symbolizer:new qe({fill:t.buildings})},{dataLayer:"roads",symbolizer:new ei({color:t.highwayCasing,width:Ke(1.4,[[5,1.5],[11,4],[16,9],[20,40]])}),filter:(t,e)=>"highway"==e.props["pmap:kind"]},{dataLayer:"roads",symbolizer:new ei({color:t.majorRoadCasing,width:Ke(1.4,[[9,3],[12,4],[17,8],[20,22]])}),filter:(t,e)=>"major_road"==e.props["pmap:kind"]},{dataLayer:"roads",symbolizer:new ei({color:t.mediumRoadCasing,width:Ke(1.4,[[13,3],[17,6],[20,18]])}),filter:(t,e)=>"medium_road"==e.props["pmap:kind"]},{dataLayer:"roads",symbolizer:new ei({color:t.minorRoadCasing,width:Ke(1.4,[[14,2],[17,5],[20,15]])}),filter:(t,e)=>"minor_road"==e.props["pmap:kind"]},{dataLayer:"roads",symbolizer:new ei({color:t.minorRoad,width:Ke(1.4,[[14,1],[17,3],[20,13]])}),filter:(t,e)=>"minor_road"==e.props["pmap:kind"]},{dataLayer:"roads",symbolizer:new ei({color:t.mediumRoad,width:Ke(1.4,[[13,2],[17,4],[20,15]])}),filter:(t,e)=>"medium_road"==e.props["pmap:kind"]},{dataLayer:"roads",symbolizer:new ei({color:t.majorRoad,width:Ke(1.4,[[9,2],[12,3],[17,6],[20,20]])}),filter:(t,e)=>"major_road"==e.props["pmap:kind"]},{dataLayer:"roads",symbolizer:new ei({color:t.highway,width:Ke(1.4,[[5,.5],[11,2.5],[16,7],[20,30]])}),filter:(t,e)=>"highway"==e.props["pmap:kind"]},{dataLayer:"boundaries",symbolizer:new ei({color:t.boundaries,width:2,opacity:.4})},{dataLayer:"mask",symbolizer:new qe({fill:t.mask})}]),xi=(t,e,i,r)=>{e&&(t=mi(t,e));var n=["name"];i&&(n=i);let a=(t,e)=>r?new ai(t instanceof ci?[t,new ci({fill:e,label_props:r})]:[t,new ui({fill:e,label_props:r})]):t;return[{dataLayer:"places",symbolizer:a(new ui({label_props:n,fill:t.countryLabel,lineHeight:1.5,font:(t,e)=>t<6?"200 14px sans-serif":"200 20px sans-serif",textTransform:"uppercase"}),t.countryLabel),filter:(t,e)=>"country"==e.props["pmap:kind"]},{dataLayer:"places",symbolizer:a(new ui({label_props:n,fill:t.stateLabel,font:"300 16px sans-serif"}),t.stateLabel),filter:(t,e)=>"state"==e.props["pmap:kind"]},{id:"cities_high",dataLayer:"places",filter:(t,e)=>"city"==e.props["pmap:kind"],minzoom:7,symbolizer:a(new ui({label_props:n,fill:t.cityLabel,font:(t,e)=>1===(null==e?void 0:e.props["pmap:rank"])?t>8?"600 20px sans-serif":"600 12px sans-serif":t>8?"600 16px sans-serif":"600 10px sans-serif"}),t.cityLabel),sort:(t,e)=>t["pmap:rank"]-e["pmap:rank"]},{id:"cities_low",dataLayer:"places",filter:(t,e)=>"city"==e.props["pmap:kind"],maxzoom:6,symbolizer:new oi([new ri({radius:2,fill:t.cityLabel}),a(new ci({label_props:n,fill:t.cityLabel,offsetX:2,offsetY:2,font:(t,e)=>1===(null==e?void 0:e.props["pmap:rank"])?t>8?"600 20px sans-serif":"600 12px sans-serif":t>8?"600 16px sans-serif":"600 10px sans-serif"}),t.cityLabel)]),sort:(t,e)=>t["pmap:rank"]-e["pmap:rank"]},{id:"neighbourhood",dataLayer:"places",symbolizer:a(new ui({label_props:n,fill:t.neighbourhoodLabel,font:"500 10px sans-serif",textTransform:"uppercase"}),t.neighbourhoodLabel),filter:(t,e)=>"neighbourhood"==e.props["pmap:kind"]},{dataLayer:"landuse",symbolizer:a(new yi({label_props:n,fill:t.landuseLabel,font:"300 12px sans-serif"}),t.landuseLabel)},{dataLayer:"water",symbolizer:a(new yi({label_props:n,fill:t.waterLabel,font:"italic 600 12px sans-serif"}),t.waterLabel)},{dataLayer:"natural",symbolizer:a(new yi({label_props:n,fill:t.naturalLabel,font:"italic 300 12px sans-serif"}),t.naturalLabel)},{dataLayer:"roads",symbolizer:a(new pi({label_props:n,fill:t.roadsLabel,font:"500 12px sans-serif"}),t.roadsLabel),minzoom:12},{dataLayer:"roads",symbolizer:new ni({label_props:["ref"],font:"600 9px sans-serif",background:t.highway,padding:2,fill:t.neighbourhoodLabel}),filter:(t,e)=>"highway"==e.props["pmap:kind"]},{dataLayer:"pois",symbolizer:new oi([new ri({radius:2,fill:t.poisLabel}),a(new ci({label_props:n,fill:t.poisLabel,offsetX:2,offsetY:2,font:"300 10px sans-serif"}),t.poisLabel)])}]},wi=(t,e,i)=>[{dataSource:t,dataLayer:e,symbolizer:new ri({opacity:.2,fill:i,radius:4}),filter:(t,e)=>e.geomType==Dt.Point},{dataSource:t,dataLayer:e,symbolizer:new ei({opacity:.2,color:i,width:2}),filter:(t,e)=>e.geomType==Dt.Line},{dataSource:t,dataLayer:e,symbolizer:new qe({opacity:.2,fill:i,stroke:i,width:1}),filter:(t,e)=>e.geomType==Dt.Polygon}],bi=(t,e)=>{var i=[];for(var[r,n]of t)for(var a of n)for(var s of a.data.keys())r===e.dataSource&&s===e.dataLayer||(i=i.concat(wi(r,s,"steelblue")));return i.concat(wi(e.dataSource||"",e.dataLayer,"red"))},vi=6378137,_i=vi*Math.PI,zi=t=>{let e=Math.PI/180,i=Math.max(Math.min(85.0511287798,t.y),-85.0511287798),r=Math.sin(i*e);return new F.default(vi*t.x*e,vi*Math.log((1+r)/(1-r))/2)},ki=(t,e)=>i=>{let r=zi(i);return new F.default((r.x+_i)/(2*_i),1-(r.y+_i)/(2*_i)).mult(256*(1<<e)).sub(t)},Mi=(t,e)=>i=>{let r=new F.default(i.x,i.y).add(t).div(256*(1<<e));return(t=>{var e=180/Math.PI;return{lat:(2*Math.atan(Math.exp(t.y/vi))-Math.PI/2)*e,lng:t.x*e/vi}})(new F.default(r.x*(2*_i)-_i,(1-r.y)*(2*_i)-_i))},Li=(t,e)=>{let i=e*(360/t);return Math.log2(i/256)},Fi=class{constructor(t){let e=t.dark?de:ue;this.paint_rules=t.paint_rules||gi(e,t.shade),this.label_rules=t.label_rules||xi(e,t.shade,t.language1,t.language2),this.backgroundColor=t.backgroundColor,this.views=ie(t),this.debug=t.debug||"",this.xray=t.xray}drawContext(t,e,i,r,n){return p(this,null,(function*(){let a=zi(r),s=new F.default((a.x+_i)/(2*_i),1-(a.y+_i)/(2*_i)).clone().mult(256*Math.pow(2,n)).sub(new F.default(e/2,i/2)),o={minX:s.x,minY:s.y,maxX:s.x+e,maxY:s.y+i},l=[];for(const[t,e]of this.views){let i=e.getBbox(n,o);l.push({key:t,promise:i})}let h=yield Promise.all(l.map((t=>t.promise.then((e=>({status:"fulfilled",value:e,key:t.key})),(e=>({status:"rejected",value:[],reason:e,key:t.key})))))),f=new Map;for(const t of h)"fulfilled"===t.status&&f.set(t.key,t.value);let u=performance.now(),d=new he(n,t,this.label_rules,16,void 0);d.add(f),this.backgroundColor&&(t.save(),t.fillStyle=this.backgroundColor,t.fillRect(0,0,e,i),t.restore());let c=this.paint_rules;if(this.xray&&(c=bi(f,this.xray)),ne(t,n,f,this.xray?null:d.index,c,o,s,!0,this.debug),this.debug){t.save(),t.translate(-s.x,-s.y),t.strokeStyle=this.debug,t.fillStyle=this.debug,t.font="12px sans-serif";let e=0;for(const[i,r]of f){for(let n of r){t.strokeRect(n.origin.x,n.origin.y,n.dim,n.dim);let r=n.data_tile;t.fillText(i+(i?" ":"")+r.z+" "+r.x+" "+r.y,n.origin.x+4,n.origin.y+14*(1+e))}e++}t.restore()}return{elapsed:performance.now()-u,project:ki(s,n),unproject:Mi(s,n)}}))}drawCanvas(t,e,i){return p(this,arguments,(function*(t,e,i,r={}){let n=window.devicePixelRatio,a=t.clientWidth,s=t.clientHeight;t.width==a*n&&t.height==s*n||(t.width=a*n,t.height=s*n),r.lang&&(t.lang=r.lang);let o=t.getContext("2d");return o.setTransform(n,0,0,n,0,0),this.drawContext(o,a,s,e,i)}))}drawContextBounds(t,e,i,r,n){return p(this,null,(function*(){let a=i.x-e.x,s=new F.default((e.x+i.x)/2,(e.y+i.y)/2);return this.drawContext(t,r,n,s,Li(a,r))}))}drawCanvasBounds(t,e,i,r){return p(this,arguments,(function*(t,e,i,r,n={}){let a=i.x-e.x,s=new F.default((e.x+i.x)/2,(e.y+i.y)/2);return this.drawCanvas(t,s,Li(a,r),n)}))}},Si=c(y()),Ci=t=>t.then((t=>({status:"fulfilled",value:t})),(t=>({status:"rejected",reason:t}))),Ti=(t={})=>{class e extends L.GridLayer{constructor(t={}){t.noWrap&&!t.bounds&&(t.bounds=[[-90,-180],[90,180]]),null==t.attribution&&(t.attribution='<a href="https://protomaps.com">Protomaps</a>  <a href="https://openstreetmap.org/copyright">OpenStreetMap</a>'),super(t);let e=t.dark?de:ue;this.paint_rules=t.paint_rules||gi(e,t.shade),this.label_rules=t.label_rules||xi(e,t.shade,t.language1,t.language2),this.backgroundColor=t.backgroundColor,this.lastRequestedZ=void 0,this.xray=t.xray,this.tasks=t.tasks||[],this.views=ie(t),this.debug=t.debug;let i=document.createElement("canvas").getContext("2d");this.scratch=i,this.onTilesInvalidated=t=>{t.forEach((t=>{this.rerenderTile(t)}))},this.labelers=new fe(this.scratch,this.label_rules,16,this.onTilesInvalidated),this.tile_size=256*window.devicePixelRatio,this.tileDelay=t.tileDelay||3,this.lang=t.lang,this.inspector=this.inspect(this)}setDefaultStyle(t,e,i,r){let n=t?de:ue;this.paint_rules=gi(n,e),this.label_rules=xi(n,e,i,r)}renderTile(t,e,i,r=(()=>{})){return p(this,null,(function*(){this.lastRequestedZ=t.z;let n=[];for(const[e,i]of this.views){let r=i.getDisplayTile(t);n.push({key:e,promise:r})}let a=yield Promise.all(n.map((t=>t.promise.then((e=>({status:"fulfilled",value:e,key:t.key})),(e=>({status:"rejected",reason:e,key:t.key})))))),s=new Map;for(const t of a)"fulfilled"===t.status?s.set(t.key,[t.value]):"AbortError"===t.reason.name||console.error(t.reason);if(e.key!=i)return;if(this.lastRequestedZ!==t.z)return;if(yield Promise.all(this.tasks.map(Ci)),e.key!=i)return;if(this.lastRequestedZ!==t.z)return;let o=this.labelers.add(t.z,s);if(e.key!=i)return;if(this.lastRequestedZ!==t.z)return;let l=this.labelers.getIndex(t.z);if(!this._map)return;let h=this._map.getCenter().wrap(),f=this._getTiledPixelBounds(h),u=this._pxBoundsToTileRange(f).getCenter(),d=t.distanceTo(u)*this.tileDelay;var c;if(yield(c=d,new Promise(((t,e)=>{setTimeout((()=>{t()}),c)}))),e.key!=i)return;if(this.lastRequestedZ!==t.z)return;let p={minX:256*t.x-16,minY:256*t.y-16,maxX:256*(t.x+1)+16,maxY:256*(t.y+1)+16},y=new Si.default(256*t.x,256*t.y);e.width=this.tile_size,e.height=this.tile_size;let m=e.getContext("2d");m.setTransform(this.tile_size/256,0,0,this.tile_size/256,0,0),m.clearRect(0,0,256,256),this.backgroundColor&&(m.save(),m.fillStyle=this.backgroundColor,m.fillRect(0,0,256,256),m.restore());var g=0;let x=this.paint_rules;if(this.xray&&(x=bi(s,this.xray)),g=ne(m,t.z,s,this.xray?null:l,x,p,y,!1,this.debug),this.debug){m.save(),m.fillStyle=this.debug,m.font="600 12px sans-serif",m.fillText(t.z+" "+t.x+" "+t.y,4,14),m.font="12px sans-serif";let e=28;for(let[t,i]of s){let r=i[0].data_tile;m.fillText(t+(t?" ":"")+r.z+" "+r.x+" "+r.y,4,e),e+=14}m.font="600 10px sans-serif",g>8&&(m.fillText(g.toFixed()+" ms paint",4,e),e+=14),o>8&&m.fillText(o.toFixed()+" ms layout",4,e),m.strokeStyle=this.debug,m.lineWidth=.5,m.beginPath(),m.moveTo(0,0),m.lineTo(0,256),m.stroke(),m.lineWidth=.5,m.beginPath(),m.moveTo(0,0),m.lineTo(256,0),m.stroke(),m.restore()}r()}))}rerenderTile(t){for(let e in this._tiles){let i=this._wrapCoords(this._keyToTileCoords(e));t===this._tileCoordsToKey(i)&&this.renderTile(i,this._tiles[e].el,t)}}clearLayout(){this.labelers=new fe(this.scratch,this.label_rules,16,this.onTilesInvalidated)}rerenderTiles(){for(let t in this._tiles){let e=this._wrapCoords(this._keyToTileCoords(t)),i=this._tileCoordsToKey(e);this.renderTile(e,this._tiles[t].el,i)}}createTile(t,e){let i=L.DomUtil.create("canvas","leaflet-tile");i.lang=this.lang;let r=this._tileCoordsToKey(t);return i.key=r,this.renderTile(t,i,r,(()=>{e(null,i)})),i}_removeTile(t){let e=this._tiles[t];e&&(e.el.removed=!0,e.el.key=void 0,L.DomUtil.removeClass(e.el,"leaflet-tile-loaded"),e.el.width=e.el.height=0,L.DomUtil.remove(e.el),delete this._tiles[t],this.fire("tileunload",{tile:e.el,coords:this._keyToTileCoords(t)}))}queryFeatures(t,e){let i=new Map;for(var[r,n]of this.views)i.set(r,n.queryFeatures(t,e,this._map.getZoom()));return i}inspect(t){return e=>{let i=["","",""],r=t._map.wrapLatLng(e.latlng),n=t.queryFeatures(r.lng,r.lat);var a="";let s=!0;for(var[o,l]of n)for(var h of l)if(!this.xray||!0===this.xray||(this.xray.dataSource||"")===o&&this.xray.dataLayer===h.layerName){a+=`<div style="margin-top:${s?0:.5}em">${i[h.feature.geomType-1]} <b>${o} ${o?"/":""} ${h.layerName}</b> ${h.feature.id||""}</div>`;for(const t in h.feature.props)a+=`<div style="font-size:0.9em">${t} = ${h.feature.props[t]}</div>`;s=!1}s&&(a="No features."),L.popup().setLatLng(e.latlng).setContent('<div style="max-height:400px;overflow-y:scroll;padding-right:8px">'+a+"</div>").openOn(t._map)}}addInspector(t){return t.on("click",this.inspector)}removeInspector(t){return t.off("click",this.inspector)}}return new e(t)},Bi=(t,e,i)=>{let r=new FontFace(t,"url("+e+")",{weight:i});return document.fonts.add(r),r.load()},Di=t=>p(void 0,null,(function*(){return new Promise(((e,i)=>{let r=new Image;r.onload=()=>e(r),r.onerror=()=>i("Invalid SVG"),r.src=t}))})),Yi=class{constructor(t){this.src=t,this.canvas=document.createElement("canvas"),this.mapping=new Map,this.missingBox={x:0,y:0,w:0,h:0}}load(){return p(this,null,(function*(){let t=this.src,e=window.devicePixelRatio;if(t.endsWith(".html")){let e=yield fetch(t);t=yield e.text()}let i=(new window.DOMParser).parseFromString(t,"text/html"),r=Array.from(i.body.children),n=yield Di("data:image/svg+xml;base64,"+btoa('\n<svg width="20px" height="20px" viewBox="0 0 50 50" version="1.1" xmlns="http://www.w3.org/2000/svg">\n    <rect width="50" height="50" fill="#cccccc"/>\n    <g transform="translate(5,5)">\n        <path fill="none" stroke="#666666" stroke-width="7" d="m11,12a8.5,8 0 1,1 17,0q0,4-4,6t-4.5,4.5-.4,4v.2m0,3v7"/>\n    </g>\n</svg>\n')),a=[{w:n.width*e,h:n.height*e,img:n,id:""}],s=new XMLSerializer;for(let t of r){var o="data:image/svg+xml;base64,"+btoa(s.serializeToString(t));let i=yield Di(o);a.push({w:i.width*e,h:i.height*e,img:i,id:t.id})}let l=function(t){let e=0,i=0;for(const r of t)e+=r.w*r.h,i=Math.max(i,r.w);t.sort(((t,e)=>e.h-t.h));const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let n=0,a=0;for(const e of t)for(let t=r.length-1;t>=0;t--){const i=r[t];if(!(e.w>i.w||e.h>i.h)){if(e.x=i.x,e.y=i.y,a=Math.max(a,e.y+e.h),n=Math.max(n,e.x+e.w),e.w===i.w&&e.h===i.h){const e=r.pop();t<r.length&&(r[t]=e)}else e.h===i.h?(i.x+=e.w,i.w-=e.w):e.w===i.w?(i.y+=e.h,i.h-=e.h):(r.push({x:i.x+e.w,y:i.y,w:i.w-e.w,h:e.h}),i.y+=e.h,i.h-=e.h);break}}return{w:n,h:a,fill:e/(n*a)||0}}(a);this.canvas.width=l.w,this.canvas.height=l.h;let h=this.canvas.getContext("2d");if(h)for(let t of a)void 0!==t.x&&void 0!==t.y&&(h.drawImage(t.img,t.x,t.y,t.w,t.h),t.id?this.mapping.set(t.id,{x:t.x,y:t.y,w:t.w,h:t.h}):this.missingBox={x:t.x,y:t.y,w:t.w,h:t.h});return this}))}get(t){let e=this.mapping.get(t);return e||(e=this.missingBox),e}};function Xi(t,e){return"number"==typeof t?t:e}function Pi(t){if(t.includes("$type"))return t=>!0;if("=="==t[0])return(e,i)=>i.props[t[1]]===t[2];if("!="==t[0])return(e,i)=>i.props[t[1]]!==t[2];if("!"==t[0]){let e=Pi(t[1]);return(t,i)=>!e(t,i)}if("<"===t[0])return(e,i)=>Xi(i.props[t[1]],1/0)<t[2];if("<="===t[0])return(e,i)=>Xi(i.props[t[1]],1/0)<=t[2];if(">"===t[0])return(e,i)=>Xi(i.props[t[1]],-1/0)>t[2];if(">="===t[0])return(e,i)=>Xi(i.props[t[1]],-1/0)>=t[2];if("in"===t[0])return(e,i)=>t.slice(2,t.length).includes(i.props[t[1]]);if("!in"===t[0])return(e,i)=>!t.slice(2,t.length).includes(i.props[t[1]]);if("has"===t[0])return(e,i)=>i.props.hasOwnProperty(t[1]);if("!has"===t[0])return(e,i)=>!i.props.hasOwnProperty(t[1]);if("all"===t[0]){let e=t.slice(1,t.length).map((t=>Pi(t)));return(t,i)=>e.every((e=>e(t,i)))}if("any"===t[0]){let e=t.slice(1,t.length).map((t=>Pi(t)));return(t,i)=>e.some((e=>e(t,i)))}return console.log("Unimplemented filter: ",t[0]),t=>!1}function ji(t){if(t.base&&t.stops)return e=>Ke(t.base,t.stops)(e-1);if("interpolate"==t[0]&&"exponential"==t[1][0]&&"zoom"==t[2]){let i=t.slice(3),r=[];for(var e=0;e<i.length;e+=2)r.push([i[e],i[e+1]]);return e=>Ke(t[1][1],r)(e-1)}if("step"==t[0]&&"get"==t[1][0]){let i=t.slice(2),r=t[1][1];return(t,n)=>{let a=null==n?void 0:n.props[r];if("number"==typeof a){if(a<i[1])return i[0];for(e=1;e<i.length;e+=2)if(a<=i[e])return i[e+1]}return i[i.length-1]}}return console.log("Unimplemented numeric fn: ",t),t=>1}function Ei(t,e=0){return t?"number"==typeof t?t:(i,r)=>r?ji(t)(i,r):e:e}function Vi(t,e){let i=Ei(t,1),r=Ei(e);return(t,e)=>{let n="number"==typeof i?i:i(t,e);return r?n+("number"==typeof r?r:r(t,e)):n}}function Ii(t,e){let i=[];for(let r of t["text-font"])e.hasOwnProperty(r)&&i.push(e[r]);0===i.length&&i.push({face:"sans-serif"});let r=t["text-size"];var n="";i.length&&i[0].weight&&(n=i[0].weight+" ");var a="";if(i.length&&i[0].style&&(a=i[0].style+" "),"number"==typeof r)return t=>`${a}${n}${r}px ${i.map((t=>t.face)).join(", ")}`;if(r.stops){var s=1.4;r.base?s=r.base:r.base=s;let t=ji(r);return(e,r)=>`${a}${n}${t(e,r)}px ${i.map((t=>t.face)).join(", ")}`}if("step"==r[0]){let t=ji(r);return(e,r)=>`${a}${n}${t(e,r)}px ${i.map((t=>t.face)).join(", ")}`}return console.log("Can't parse font: ",t),t=>"12px sans-serif"}function Ai(t,e){let i=[],r=[],n=new Map;for(var a of t.layers)if(n.set(a.id,a),!a.layout||"none"!=a.layout.visibility){if(a.ref){let t=n.get(a.ref);a.type=t.type,a.filter=t.filter,a.source=t.source,a["source-layer"]=t["source-layer"]}a["source-layer"];var s=void 0;a.filter&&(s=Pi(a.filter)),"fill"==a.type?i.push({dataLayer:a["source-layer"],filter:s,symbolizer:new qe({fill:a.paint["fill-color"],opacity:a.paint["fill-opacity"]})}):"fill-extrusion"==a.type?i.push({dataLayer:a["source-layer"],filter:s,symbolizer:new qe({fill:a.paint["fill-extrusion-color"],opacity:a.paint["fill-extrusion-opacity"]})}):"line"==a.type?a.paint["line-dasharray"]?i.push({dataLayer:a["source-layer"],filter:s,symbolizer:new ei({width:Vi(a.paint["line-width"],a.paint["line-gap-width"]),dash:a.paint["line-dasharray"],dashColor:a.paint["line-color"]})}):i.push({dataLayer:a["source-layer"],filter:s,symbolizer:new ei({color:a.paint["line-color"],width:Vi(a.paint["line-width"],a.paint["line-gap-width"])})}):"symbol"==a.type?"line"==a.layout["symbol-placement"]?r.push({dataLayer:a["source-layer"],filter:s,symbolizer:new pi({font:Ii(a.layout,e),fill:a.paint["text-color"],width:a.paint["text-halo-width"],stroke:a.paint["text-halo-color"],textTransform:a.layout["text-transform"],label_props:a.layout["text-field"]?[a.layout["text-field"]]:void 0})}):r.push({dataLayer:a["source-layer"],filter:s,symbolizer:new ui({font:Ii(a.layout,e),fill:a.paint["text-color"],stroke:a.paint["text-halo-color"],width:a.paint["text-halo-width"],textTransform:a.layout["text-transform"],label_props:a.layout["text-field"]?[a.layout["text-field"]]:void 0})}):"circle"==a.type&&i.push({dataLayer:a["source-layer"],filter:s,symbolizer:new ri({radius:a.paint["circle-radius"],fill:a.paint["circle-color"],stroke:a.paint["circle-stroke-color"],width:a.paint["circle-stroke-width"]})})}return r.reverse(),{paint_rules:i,label_rules:r,tasks:[]}}var Ui=t=>{let e=Oe(4,4,(t=>{var e=t.getContext("2d");e&&(e.beginPath(),e.rect(0,0,1,1),e.rect(2,2,1,1),e.fillStyle="black",e.fill())}));var i="black";"lite"===t&&(i="#d9d9d9");let r=["name:en","name"],n=[{dataLayer:"earth",symbolizer:new qe({fill:"white"})},{dataLayer:"landuse",symbolizer:new qe({pattern:e}),filter:(t,e)=>"park"==e.props.leisure},{dataLayer:"water",symbolizer:new qe({fill:i})},{dataLayer:"roads",symbolizer:new ei({color:"#dddddd"}),filter:(t,e)=>"minor_road"===e.props["pmap:kind"]},{dataLayer:"roads",symbolizer:new ei({color:"white",width:$e(16,[7,9,17,20])}),filter:(t,e)=>"medium_road"===e.props["pmap:kind"]},{dataLayer:"roads",symbolizer:new ei({color:"#cccccc",width:$e(10,[.2,.2,.2,.4,.8,1.5,4,7,13,16])}),filter:(t,e)=>"medium_road"===e.props["pmap:kind"]},{dataLayer:"roads",symbolizer:new ei({color:"white",width:$e(11,[1.25,5,5,5,8,11,18,22,30])}),filter:(t,e)=>"major_road"===e.props["pmap:kind"]},{dataLayer:"roads",symbolizer:new ei({color:"black",width:$e(9,[.15,.5,.7,1,1.5,1.9,5,7,12,18,26])}),filter:(t,e)=>"major_road"===e.props["pmap:kind"]},{dataLayer:"roads",symbolizer:new ei({color:"white",width:$e(7,[2.25,3.25,4.25,5,6,7,8,9,11,14,24,42,49])}),filter:(t,e)=>"highway"===e.props["pmap:kind"]},{dataLayer:"roads",symbolizer:new ei({color:"black",width:$e(6,[.1,1.5,1.5,1.5,2,2.5,3,3,4,6,9,15,28,35])}),filter:(t,e)=>"highway"===e.props["pmap:kind"]},{dataLayer:"transit",symbolizer:new ei({color:"#888888",dashColor:"#888888",dash:[1,4],dashWidth:3}),filter:(t,e)=>"railway"===e.props["pmap:kind"],minzoom:14},{dataLayer:"transit",symbolizer:new ei({color:"#888888"}),filter:(t,e)=>"railway"===e.props["pmap:kind"],minzoom:14},{dataLayer:"buildings",symbolizer:new ei({color:"#888888",width:.5})},{dataLayer:"boundaries",symbolizer:new ei({color:"black",width:1}),maxzoom:6},{dataLayer:"boundaries",symbolizer:new ei({color:"white",width:2.5,dash:[3,1],dashWidth:.3,dashColor:"black"}),minzoom:7}],a=[{dataLayer:"places",symbolizer:new ui({label_props:r,fill:"black",stroke:"white",width:1.5,fontFamily:"Inter",fontWeight:300,fontSize:15,justify:Fe.Center}),filter:(t,e)=>"country"==e.props["pmap:kind"]},{dataLayer:"places",symbolizer:new ui({label_props:r,fill:"black",stroke:"white",width:2,fontFamily:"Inter",fontWeight:300,fontSize:12,justify:Fe.Center}),filter:(t,e)=>"state"==e.props["pmap:kind"]},{dataLayer:"places",symbolizer:new oi([new ri({radius:2,fill:"black",stroke:"white",width:2}),new ci({label_props:r,offsetX:3,fill:"black",stroke:"white",width:1.5,fontFamily:"Inter",fontWeight:600,fontSize:(t,e)=>1==e.props["pmap:rank"]?15:13})]),sort:(t,e)=>t["pmap:rank"]-e["pmap:rank"],filter:(t,e)=>"city"==e.props["pmap:kind"],maxzoom:8},{dataLayer:"places",symbolizer:new ui({label_props:r,justify:Fe.Center,fill:"black",stroke:"white",width:2,fontFamily:"Inter",fontWeight:600,fontSize:(t,e)=>1==e.props["pmap:rank"]?15:13}),sort:(t,e)=>t["pmap:rank"]-e["pmap:rank"],filter:(t,e)=>"city"==e.props["pmap:kind"],minzoom:9},{dataLayer:"water",symbolizer:new yi({label_props:r,fill:"white",stroke:"black",width:3,font:"italic 400 12px Inter"})},{dataLayer:"landuse",symbolizer:new yi({fill:"black",stroke:"white",width:2,font:"italic 400 12px Inter"})},{dataLayer:"physical_point",symbolizer:new ui({label_props:r,fill:"white",stroke:"black",width:3,font:"italic 600 12px Inter",textTransform:"uppercase",justify:Fe.Center}),filter:(t,e)=>["ocean","sea"].includes(e.props.place)},{dataLayer:"roads",symbolizer:new pi({fill:"black",stroke:"white",width:2,font:"600 14px Inter",offset:4})}];return{tasks:[Bi("Inter","https://cdn.protomaps.com/fonts/woff2/Inter.var.woff2","100 900")],paint_rules:n,label_rules:a,attribution:'Map tiles by <a href="http://stamen.com">Stamen Design</a>, under <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a>.'}}}}]);